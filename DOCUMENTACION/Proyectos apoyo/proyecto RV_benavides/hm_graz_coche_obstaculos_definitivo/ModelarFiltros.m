%DiseñarFiltros
%Sirve para diseñar los filtros que se aplicaran a los distintos canales, 
%justo antes de hacer sus estimaciones espectrales.
%
%Cada canal tendra un banco de 'nmfltros' filtros en serie.
%
%El filtro equivalente del banco de filtros de cada canal, se guardara
%en variables globales en forma de matrices:
%Por ejemplo: NumCh1 es el numerador equivalente del banco de filtros
%del canal 1.
%Nums= [NumCh1 ; NumCh2 ; NumCh3 ; NumCh4 ];
%Dens= [DenCh1 ; DenCh2 ; DenCh3 ; DenCh4 ];

global nmfltros nch;
global COLOR_C1 COLOR_C2 COLOR_C3 COLOR_C4;
global COLOR_FONDO_TEXTOS COLOR_FONDO_PETICIONES COLOR_TEXTO_PETICIONES COLOR_TEXTO_MARCAS ColorFondoEjes; 
global filtroi modof fltrdo_algoritmo fltrdo_tipo fltrdo_orden fltrdo_rizo_c fltrdo_fc1 fltrdo_fc2 ...
   fltrdo_wp1 fltrdo_wp2 fltrdo_ws1 fltrdo_ws2 fltrdo_rizo_p fltrdo_rizo_s Nums Dens;
global Num Den; %fdatool exporta las variables al Workspace, y saber si esas variables han
%                aparecido o no en el Workspace es la unica forma que tenemos de saber cuando
%                se ha terminado con fdatool. Por tanto, es necesario que usemos unas variables
%                'Num' y 'Den' globales.(Para comprender mejor esto, ver lo que se hace cuando
%                se llama a fdatool en NumDenFiltro1 y NumDenFiltro2).
%------------------------------------------------------------ Inicializacion de Variables

filtroi=ones(1,nch);%Al iniciar el programa, el primer filtro del banco en verse será el filtro 1

%------------------------------------------------------------------- Diseño de la Ventana
unidades=get(0,'Units'); %Guardamos la unidad en que esta la ventana principal
set(0,'Units','cent');%Pasamos las unidades a 'centimetros', que nos interesan mas:
Screensize=get(0,'Screensize'); %Ahora sabemos el tamaño de nuestra pantalla en centimetros
posicion=[Screensize(3)/2-6.3 Screensize(4)/2-5]; %Screensize(3) es el ancho de la ventana principal, osea el monitor
set(0,'Units',unidades); %Reponemos las unidades de la ventana principal 
figure(6); %Para ver la pantalla del juego
set(gcf,'MenuBar','none','NumberTitle','off',...
   'Name','Diseño de Filtros para los distintos canales',...
   'units','cent','Position',[posicion 12.6 10]);

x1=2.5;
y1=7.5; y2=5; y3= 2.5; y4=0;%Para simplificar el posicionamiento de los uicontrols
%---CANAL 1 -------------------------------------------------------------------------------
%---------------------------------------------------------------------------------FILTRADO:

%---------------------------------------------------------------------------MARCO FILTRADO:
%Hay dos formas de calcular un filtro en Matlab:
%- Forma 1: Indicando los parametros(orden,rizo,frec/frecs de corte) 
%  --> Utiliza Butter, Besself, Cheby1, ...
%
%- Forma 2: Indicando los parametros(Banda de Paso, Banda de rechazo, rizo en B.Paso,
%  rizo en B.Rechazo). --> Utiliza Buttord, (¡¡para Bessel no hay!!), Cheb1ord, Cheb2ord, ...
%  Con esas funciones, se calculan los parametros (orden,rizo,frec/frecs de corte), con
%  lo que se trasforma el problema en uno del tipo 1.
marco_fltrdo_ch1= uicontrol( ...
	'Style','frame', ...
   'Units','cent', ...
   'Position',[x1+.1 y1+.1 9.8 2.3], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES);
%-----------------------------------------------------------------Botón para elegir FILTRO:
Desactivar_Modo1_ch1=[...
      '  set(popup_fltrdo_tipo_ch1,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch1,''enable'',''off'');',...
      '  set(editHndl.fltrdo_orden_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_fc1_ch1,''enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch1,''Enable'',''off'');'];
Activar_Modo1_ch1=[...
      '  set(popup_fltrdo_tipo_ch1,''Enable'',''on'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch1,''enable'',''on'');',...
      '  set(editHndl.fltrdo_orden_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_c_ch1,''enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_c_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_fc1_ch1,''enable'',''on'');',...
      '  set(editHndl.fltrdo_fc1_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch1,''Enable'',''on'');'];
Activar_Modo2_ch1=[...
      '  set(text_fltrdo_paso1_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch1,''Enable'',''on'');'];
Desactivar_Modo2_ch1=[...
      '  set(text_fltrdo_paso1_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch1,''Enable'',''off'');'];
      
Accion_push_filtroi_ch1=['filtroi(1)=filtroi(1)+1;',...
      'if filtroi(1)>nmfltros, filtroi(1)=1; end;',...
      'set(pushHndl_filtroi_ch1,''String'',[''filtro '' num2str(filtroi(1))]);',...
      'set(popup_fltrdo_algoritmo_ch1,''Value'',fltrdo_algoritmo(filtroi(1),1));',... %Ningurno,Butterworth,...
      'set(popup_fltrdo_tipo_ch1,''Value'',fltrdo_tipo(filtroi(1),1));',... %pasobajo, pasoalto, pasobanda,...
      'set(pushHndl_modof_ch1,''string'',[''Modo '' num2str(modof(filtroi(1),1))]);',...
      'set(editHndl.fltrdo_orden_ch1,''String'',[fltrdo_orden(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_rizo_c_ch1,''String'',[fltrdo_rizo_c(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_fc1_ch1,''String'',[fltrdo_fc1(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_fc2_ch1,''String'',[fltrdo_fc2(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_wp1_ch1,''String'',[fltrdo_wp1(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_wp2_ch1,''String'',[fltrdo_wp2(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_rizo_p_ch1,''String'',[fltrdo_rizo_p(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_ws1_ch1,''String'',[fltrdo_ws1(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_ws2_ch1,''String'',[fltrdo_ws2(filtroi(1),1)]);',...
      'set(editHndl.fltrdo_rizo_s_ch1,''String'',[fltrdo_rizo_s(filtroi(1),1)]);',...%ACTIVACIONES:
      'if ((modof(filtroi(1),1)==1 & fltrdo_algoritmo(filtroi(1),1)>=7) | (modof(filtroi(1),1)==2 & fltrdo_algoritmo(filtroi(1),1)>=6)),',...%=>fdatool
      '',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '  set(pushHndl_modof_ch1,''Enable'',''off'');',...
      '  eval(Desactivar_Modo1_ch1);',...
      '  eval(Desactivar_Modo2_ch1);',...
      'else,',...%Se hacen activaciones en funcion de modof(filtroi(1),1)
      '  set(pushHndl_modof_ch1,''Enable'',''on'');',...
      '  set(popup_fltrdo_algoritmo_ch1,''Enable'',''on'');',... %Ninguno, Butterworth,...
      '  if modof(filtroi(1),1)==1,',...%Activamos los parametros del modo 1 y desactivamos los parametros del modo 2:
      '     set(popup_fltrdo_algoritmo_ch1,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Activar_Modo1_ch1);',...%Y desactivamos lo que haga falta en funcion del algoritmo:
      '     if (fltrdo_algoritmo(filtroi(1),1)<4 | fltrdo_algoritmo(filtroi(1),1)>6),',... %Inabilitación/Deshabilitación del rizo:
      '	      set(text_fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '        set(editHndl.fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '     end;',...
      '     if (fltrdo_tipo(filtroi(1),1)<3 | fltrdo_algoritmo(filtroi(1),1)>4),',...%Desabilitacion de fc2:
      '        set(editHndl.fltrdo_fc2_ch1,''enable'',''off'');',...%pasobajo y pasoalto no lo necesitan
      '     end;',...
      '     eval(Desactivar_Modo2_ch1);',...
      '  else, ',...%Activamos los parametros del modo 2 y desactivamos los parametros del modo 1:
      '     set(popup_fltrdo_algoritmo_ch1,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Desactivar_Modo1_ch1);',...
      '     eval(Activar_Modo2_ch1);',...
      '  end;',...
      'end;',...
      'PlotFiltro(filtroi(1),Nums.ch1,Dens.ch1,eje_filtro_ch1);'];

pushHndl_filtroi_ch1= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+.25 y1+1.8 2.25 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Conmuta entre los distintos filtros',...
   'String',['filtro ' num2str(filtroi(1))], ...
   'CallBack',Accion_push_filtroi_ch1); %Hace: eval(Accion_push_filtroi_ch1)

%-----------------------------------------------------Menú pop-up para elegir ALGORITMO de filtrado:
%Filtrando la señal, conseguimos que los metodos parametricos se 'concentren' en el
%ancho de banda deseado, ya que disminuimos la potencia de los posibles picos que 
%pueda haber fuera de dicho ancho de banda.

Accionpopup_fltrdo_algoritmo_ch1= [... %Habrá que tener en cuenta el modo de fltrdo(1 ó 2) pq el modo2 no acepta Bessel.
      'fltrdo_algoritmo(filtroi(1),1) = get(popup_fltrdo_algoritmo_ch1,''Value'');',...
      'if modof(filtroi(1),1)==1,'...%Modo 1 de fltrdo:Ninguno|Butter|Bessel|Cheb1|Cheb2|Elip|Cargar|Diseñar:
      '  if fltrdo_algoritmo(filtroi(1),1)>=7,',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '     set(pushHndl_modof_ch1,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch1);',...
      '     eval(Desactivar_Modo2_ch1);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch1,''Enable'',''on'');',...
      '     eval(Activar_Modo1_ch1);',...
	   '	   if (fltrdo_algoritmo(filtroi(1),1)>=4 & fltrdo_algoritmo(filtroi(1),1)<=6),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '	   end;',... 
      '     if fltrdo_tipo(filtroi(1),1)<=2,',...%Filtrados tipo pasobajo/pasoalto no usan la frecuencia fc2
      '        set(editHndl.fltrdo_fc2_ch1,''Enable'',''off'');',...
      '     end;',...
      '     eval(Desactivar_Modo2_ch1);',...
      '  end;',...
      '  [Nums.ch1,Dens.ch1]  =  NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
      'else,',...%modof(filtroi(1),1)==2;(El problema es que no hay bessel y los rangos de fltrdo_algoritmo cambian
      '  if fltrdo_algoritmo(filtroi(1),1)>=6,',...
      '     set(pushHndl_modof_ch1,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch1);',...
      '     eval(Desactivar_Modo2_ch1);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch1,''Enable'',''on'');',...
      '     eval(Activar_Modo2_ch1);',...
      '	   if (fltrdo_algoritmo(filtroi(1),1)>=3 & fltrdo_algoritmo(filtroi(1),1)<=5),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch1,''enable'',''off'');',...
      '	   end;',... 
      '  end;',...
      '	[Nums.ch1,Dens.ch1]  = NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      'end;',...
      'if (Num==1 & Den==1),',...%Sobretodo pensado por si hay un error al cargar un filtro
      '   fltrdo_algoritmo_ch1(filtroi(1),1)=1;',...
      '   set(popup_fltrdo_algoritmo_ch1,''Value'',1);',...
      'end;'];

popup_fltrdo_algoritmo_ch1 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+2.5 y1+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar', ...
   'ToolTipString','Elija el algoritmo de fltrdo',...
   'Value',fltrdo_algoritmo(filtroi(1),1), ...
   'CallBack',Accionpopup_fltrdo_algoritmo_ch1); 

%------------------------Menú pop-up para elegir filtro Paso-alto/Paso-bajo/Passo-Banda/Rechazo-Banda:
Accionpopup_fltrdo_tipo_ch1=['fltrdo_tipo(filtroi(1),1) = get(popup_fltrdo_tipo_ch1,''Value'');',...
      'if fltrdo_tipo(filtroi(1),1)<=2,',...%es pasobajo/pasoalto
      'set(editHndl.fltrdo_fc2_ch1,''enable'',''off'');',...
      'else,',...%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
      'set(editHndl.fltrdo_fc2_ch1,''enable'',''on'');',...
      'end;',...
      '[Nums.ch1,Dens.ch1] = NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
      ];

popup_fltrdo_tipo_ch1 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+4.8 y1+1.8 2.7 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Pasobajo|Pasoalto|PasoBanda|Rechazobanda', ...
   'ToolTipString','Elija el tipo de filtro',...
   'Value',fltrdo_tipo(filtroi(1),1), ...
   'CallBack',Accionpopup_fltrdo_tipo_ch1); 

%-----------------------------------------FILTROS SEGUN ORDEN/RIZADO/FRECUENCIAS DE CORTE:
%----------------------------------------------------------------------- Orden del filtro:
text_fltrdo_orden_ch1=uicontrol( ...
   'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y1+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Orden:', ...
   'ToolTipString','Orden del filtro');

Accion_fltrdo_orden_ch1=['fltrdo_orden(filtroi(1),1)=str2num(get(editHndl.fltrdo_orden_ch1,''String''));',...
      '[Nums.ch1,Dens.ch1] = NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
   ];
editHndl.fltrdo_orden_ch1 = uicontrol( ...  
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+1.15 y1+1.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_orden(filtroi(1),1)], ... 
   'ToolTipString','',...
   'CallBack',Accion_fltrdo_orden_ch1); 

%-------------------------------------------- Rizado en la banda de paso limitado por fc:
text_fltrdo_rizo_c_ch1=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+2 y1+1.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizado[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)');

Accion_fltrdo_rizo_c_ch1=['fltrdo_rizo_c(filtroi(1),1)=str2num(get(editHndl.fltrdo_rizo_c,''String''));',...
      '[Nums.ch1,Dens.ch1] = NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_rizo_c_ch1 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+3.6 y1+1.2 .8 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_c(filtroi(1),1)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)',...
    'CallBack',Accion_fltrdo_rizo_c_ch1); 
 
if (fltrdo_algoritmo(filtroi(1),1)>=3 & fltrdo_algoritmo(filtroi(1),1)<=4),
   set(editHndl.fltrdo_rizo_c_ch1,'enable','on');
   set(text_fltrdo_rizo_c_ch1,'enable','on');
else,
   set(editHndl.fltrdo_rizo_c_ch1,'enable','off');
   set(text_fltrdo_rizo_c_ch1,'enable','off')
end;

%--------------------------------------------------------Frecuencias de corte del filtro:
%Pueden especificarse una o dos frecuencias, dependiendo de si hablamos de un fltrdo
%pasoalto/pasobajo o pasobanda/rechazobanda.
%Para los filtros sin rizo, esta frecuencia es la frec. de 3dB de atenuacion, y para los
%filtros con rizo es la frecuencia de 'rizo' dB de atenuacion.
text_fltrdo_fc1_ch1=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+4.5 y1+1.2 3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','frecs. de corte[Hz]:fc1:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');

Accion_fltrdo_fc1_ch1=['fltrdo_fc1(filtroi(1),1)=str2num(get(editHndl.fltrdo_fc1_ch1,''String''));',...
      'if fltrdo_fc1(filtroi(1),1)>Fs/2, fltrdo_fc1(filtroi(1),1)=Fs/2; set(editHndl.fltrdo_fc1_ch1,''String'',[fltrdo_fc1(filtroi(1),1)]);',...
      'aviso(''Frecuencia de corte tiene que se menor que la de Nyquist''); end;',...
      '[Nums.ch1,Dens.ch1] = NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_fc1_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+7.4 y1+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc1(filtroi(1),1)], ... 
   'ToolTipString','Frecuencia de corte inferior del filtro(sin normalizar)',...
   'CallBack',Accion_fltrdo_fc1_ch1); 

text_fltrdo_fc2_ch1= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+8.3 y1+1.2 .5 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','fc2:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');
Accion_fltrdo_fc2_ch1= ['fltrdo_fc2(filtroi(1),1)=str2num(get(editHndl.fltrdo_fc2_ch1,''String''));',...
      'if fltrdo_fc2(filtroi(1),1)<=fltrdo_fc1(filtroi(1),1), fltrdo_fc1(filtroi(1),1)=1.1*fltrdo_fc2(filtroi(1),1); set(editHndl.fltrdo_fc2_ch1,''String'',[fltrdo_fc2(filtroi(1),1)]);',...
      'aviso(''Frecuencia de corte superior tiene que ser mayor que la inferior''); end;',...
      '[Nums.ch1,Dens.ch1] = NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_fc2_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y1+1.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc2(filtroi(1),1)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior del filtro sin normalizar',...
   'CallBack',Accion_fltrdo_fc2_ch1);

if fltrdo_tipo(filtroi(1),1)<=2,%es pasobajo/pasoalto
   set(editHndl.fltrdo_fc2_ch1,'enable','off');
else,%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
   set(editHndl.fltrdo_fc2_ch1,'enable','on');
end;

%---------------------------------------------------FILTROS SEGUN BANDAS DE PASO/RIZADOS:
%---------------------------------------------------------------Banda de Paso del filtro:
%Es la banda de paso del filtro, en la que habra un rizo maximo indicado por Rp(rizo
%en la banda de paso).
text_fltrdo_paso1_ch1=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y1+.7 2.9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de paso[Hz]=[', ...
   'ToolTipString','Banda de paso[fp1,fp2][Hz] del filtro');

Accion_fltrdo_wp1_ch1=['fltrdo_wp1(filtroi(1),1)=str2num(get(editHndl.fltrdo_wp1_ch1,''String''));',...
      'if (fltrdo_wp1(filtroi(1),1)>=fltrdo_wp2(filtroi(1),1) | fltrdo_wp1(filtroi(1),1)<=fltrdo_ws1(filtroi(1),1)),',...
      'fltrdo_wp1(filtroi(1),1)=min(1.1*fltrdo_ws1(filtroi(1),1),0.9*fltrdo_wp2(filtroi(1),1));',...
      'set(editHndl.fltrdo_wp1_ch1,''String'',[fltrdo_wp1(filtroi(1),1)]);',...
      'aviso(''f_paso1 debe quedar en (f_rechazo1,f_paso2).'');',...
      'end;',...
      '[Nums.ch1,Dens.ch1]= NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
   ];
editHndl.fltrdo_wp1_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.15 y1+.7 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp1(filtroi(1),1)], ... 
   'ToolTipString','Frecuencia de paso inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp1_ch1); 

text_fltrdo_paso2_ch1= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+3.95 y1+.7 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_wp2_ch1= ['fltrdo_wp2(filtroi(1),1)=str2num(get(editHndl.fltrdo_wp2_ch1,''String''));',...
      'if (fltrdo_wp2(filtroi(1),1)>=fltrdo_ws2(filtroi(1),1) | fltrdo_wp2(filtroi(1),1)<=fltrdo_wp1(filtroi(1),1)),',...
      '  fltrdo_wp2(filtroi(1),1)=max(1.1*fltrdo_wp1(filtroi(1),1),0.9*fltrdo_ws2(filtroi(1),1));',...
      '  set(editHndl.fltrdo_wp2_ch1,''String'',[fltrdo_wp2(filtroi(1),1)]);',...
      '  aviso(''f_paso2 debe quedar en (f_paso1,f_rechazo2).'');',...
      'end;',...
      '[Nums.ch1,Dens.ch1]= NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_wp2_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.1 y1+.7 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp2(filtroi(1),1)], ... 
   'ToolTipString','Frecuencia[Hz] de paso superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp2_ch1);

text_fltrdo_paso3_ch1= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.1 y1+.7 1.9 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] --------------->');

%------------------------------------- Rizado en la banda de paso limitado por [wp1,wp2]:
text_fltrdo_rizo_p_ch1= uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y1+.7 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de paso');

Accion_fltrdo_rizo_p_ch1= ['fltrdo_rizo_p(filtroi(1),1)=str2num(get(editHndl.fltrdo_rizo_p_ch1,''String''));',...
      '[Nums.ch1,Dens.ch1]= NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_rizo_p_ch1 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+8.8 y1+.7 1 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_p(filtroi(1),1)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso',...
    'CallBack',Accion_fltrdo_rizo_p_ch1); 
 
%------------------------------------------------Banda de Rechazo del filtro[ws1,ws2]:
%Es la banda de rechazo del filtro, en la que habra un rizo maximo indicado por 
%fltrdo_rizo_s(rizo en la banda de rechazo).
text_fltrdo_rechazo1_ch1= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y1+.2 3.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de rechazo[Hz]=[', ...
   'ToolTipString','Banda de rechazo[fs1,fs2][Hz] del filtro');

Accion_fltrdo_ws1_ch1= ['fltrdo_ws1(filtroi(1),1)=str2num(get(editHndl.fltrdo_ws1_ch1,''String''));',...
      'if (fltrdo_ws1(filtroi(1),1)>=fltrdo_wp1(filtroi(1),1) | fltrdo_ws1(filtroi(1),1)<=0),',...
      'fltrdo_ws1(filtroi(1),1)=max(.1,0.9*fltrdo_wp1(filtroi(1),1));',...
      'set(editHndl.fltrdo_ws1_ch1,''String'',[fltrdo_ws1(filtroi(1),1)]);',...
      'aviso(''f_rechazo1 debe quedar en (0,f_paso1).'');',...
      'end;',...
      '[Nums.ch1,Dens.ch1]= NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_ws1_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.45 y1+.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws1(filtroi(1),1)], ... 
   'ToolTipString','Frecuencia de corte inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws1_ch1); 

text_fltrdo_rechazo2_ch1=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+4.25 y1+.2 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_ws2_ch1=['fltrdo_ws2(filtroi(1),1)=str2num(get(editHndl.fltrdo_ws2_ch1,''String''));',...
      'if (fltrdo_ws2(filtroi(1),1)>=Fs/2 | fltrdo_ws2(filtroi(1),1)<=fltrdo_wp2(filtroi(1),1)),',...
      'fltrdo_ws2(filtroi(1),1)=min(1.1*fltrdo_wp2(filtroi(1),1),0.9*Fs/2);',...
      'set(editHndl.fltrdo_ws2_ch1,''String'',[fltrdo_ws2(filtroi(1),1)]);',...
      'aviso(''f_rechazo2 debe quedar en (f_paso2,Fs/2).'');',...
      'end;',...
      '[Nums.ch1,Dens.ch1]=NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_ws2_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.4 y1+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws2(filtroi(1),1)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws2_ch1);

text_fltrdo_rechazo3_ch1=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.4 y1+.2 1.6 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] ------------>');

%------------------------------------- Rizado en la banda de rechazo limitado por [ws1,ws2]:
text_fltrdo_rizo_s_ch1=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y1+.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de rechazo');

Accion_fltrdo_rizo_s_ch1=['fltrdo_rizo_s(filtroi(1),1)=str2num(get(editHndl.fltrdo_rizo_s_ch1,''String''));',...
      '[Nums.ch1,Dens.ch1]= NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      ];
editHndl.fltrdo_rizo_s_ch1 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y1+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_rizo_s(filtroi(1),1)], ...
   'ToolTipString','rizo[dB] del filtro en la banda de rechazo',...
   'CallBack',Accion_fltrdo_rizo_s_ch1);

%---------------------------------------------------------PLOT FILTRO(en Panel de Control)
%Para hacerlo, hay que esperar a tener todas las variables que pide.
Accion_eje_salida=[...
         'figure(2);',...
         'freqz(Nums.ch1(filtroi(1),:),Dens.ch1(filtroi(1),:),512,Fs);',...
         'title([''Filtro '' num2str(filtroi(1)) ]);',...
         'pulsador;',...
         'Numtotal=1;   Dentotal=1;',...%Esta funcion se llamara una vez terminado NumDenFiltro2,
         'for nf=1:nmfltros,',...%asi que habra que usar variables que existan en ese momento
         '  Numtotal=conv(Numtotal,Nums.ch1(nf,:));',...
         '  Dentotal=conv(Dentotal,Dens.ch1(nf,:));',...
         'end;',...
         'freqz(Numtotal,Dentotal,512,Fs);',...
         'title(''Filtro conjunto'');'];
eje_filtro_ch1= axes('Units','cent','Position',[.4 y1+.4 2 2],'ButtonDownFcn',Accion_eje_salida);
PlotFiltro(filtroi(1),Nums.ch1,Dens.ch1,eje_filtro_ch1); %Es una funcion.
%-------------------------------------------------------------------Boton MODO de filtrado:
%Sirve para conmutar entre la Forma 1 y la Forma 2 de calcular un filtro.
Accion_push_modof_ch1= [...
      'if modof(filtroi(1),1)==1,  modof(filtroi(1),1)=2;',...%Forma2=> Parametros(Wp=[wp1,wp2], Ws=[ws1,ws2], Rp, Rs)
      '  set(popup_fltrdo_algoritmo_ch1,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '  if fltrdo_algoritmo(filtroi(1),1)==3,',...%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      '     fltrdo_algoritmo(filtroi(1),1)= 1;	set(popup_fltrdo_algoritmo_ch1,''Value'',1);',...
      '  elseif fltrdo_algoritmo(filtroi(1),1)>3,',...%Hay  que restar 1 pq en modof(filtroi(1),1)==2, no hay Bessel
      '     fltrdo_algoritmo(filtroi(1),1)= fltrdo_algoritmo(filtroi(1),1) - 1;	set(popup_fltrdo_algoritmo_ch1,''Value'',fltrdo_algoritmo(filtroi(1),1));',...
      '  end;',...
      '  set(pushHndl_modof_ch1,''String'',''Modo 2'');',...%Quitamos el algoritmo de Bessel, q no puede hacerse asi:
      '  set(popup_fltrdo_tipo_ch1,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(editHndl.fltrdo_orden_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_paso1_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch1,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch1,''Enable'',''on'');',...
      '	[Nums.ch1,Dens.ch1] = NumDenFiltro2(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),[fltrdo_wp1(:,1) fltrdo_wp2(:,1)]/(Fs/2),[fltrdo_ws1(:,1) fltrdo_ws2(:,1)]/(Fs/2),fltrdo_rizo_p(:,1),fltrdo_rizo_s(:,1),Nums.ch1,Dens.ch1);',...
      'else,         modof(filtroi(1),1)=1;',...%Forma 1=> Parametros(orden,rizo,Wn)
      '  set(pushHndl_modof_ch1,''String'',''Modo 1'');',...
      '  set(popup_fltrdo_algoritmo_ch1,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');'...
      '  if fltrdo_algoritmo(filtroi(1),1)>2,',...%(3=>Chebyshev 1)Hay  que sumar 1 ya que en modof==1 si hay Bessel
      '     fltrdo_algoritmo(filtroi(1),1)= fltrdo_algoritmo(filtroi(1),1) + 1;	set(popup_fltrdo_algoritmo_ch1,''Value'',fltrdo_algoritmo(filtroi(1),1));',...
      '  end;',...
      '  set(popup_fltrdo_tipo_ch1,''Enable'',''on'',''Value'', fltrdo_tipo(filtroi(1),1));',...
      '  set(editHndl.fltrdo_orden_ch1,''Enable'',''on'');',...
      '  if (fltrdo_algoritmo(filtroi(1),1)>=4 & fltrdo_algoritmo(filtroi(1),1)<=6),',...
      '     set(editHndl.fltrdo_rizo_c_ch1,''enable'',''on'');',...
      '     set(text_fltrdo_rizo_c_ch1,''enable'',''on'');',...
      '  else,',...%Nada porque ya estan off
      '  end;',...
      '  set(editHndl.fltrdo_fc1_ch1,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch1,''Enable'',''on'');',...%Al ser siempre pasobanda, siempre se activa fc2 
      '  set(text_fltrdo_paso1_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch1,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch1,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch1,''Enable'',''off'');',...
      '  [Nums.ch1,Dens.ch1] = NumDenFiltro1(eje_filtro_ch1,filtroi(1),fltrdo_algoritmo(:,1),fltrdo_orden(:,1),fltrdo_rizo_c(:,1),fltrdo_tipo(:,1),[fltrdo_fc1(:,1) fltrdo_fc2(:,1)]/(Fs/2),Nums.ch1,Dens.ch1);',...
      'end;'];
pushHndl_modof_ch1= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+7.5 y1+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Modo 1/2 de fltrdo',...
   'String',['Modo ' num2str(modof(filtroi(1),1))], ...
   'CallBack',Accion_push_modof_ch1);

%Al iniciar el programa, hay que adaptar el panel al valor de 'modof':
%NOTA: Al comienzo, todo esta 'on' solo hay que concentrarse en poner 'off':
if modof(filtroi(1),1)==1,
   set(popup_fltrdo_algoritmo_ch1,'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   %set(popup_fltrdo_tipo,'Enable','on');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(text_fltrdo_paso1_ch1,'Enable','off');
   set(text_fltrdo_paso2_ch1,'Enable','off');
   set(text_fltrdo_paso3_ch1,'Enable','off');
   set(editHndl.fltrdo_wp1_ch1,'Enable','off');
   set(editHndl.fltrdo_wp2_ch1,'Enable','off');
   set(text_fltrdo_rizo_p_ch1,'Enable','off');
   set(editHndl.fltrdo_rizo_p_ch1,'Enable','off');
   set(text_fltrdo_rechazo1_ch1,'Enable','off');
   set(text_fltrdo_rechazo2_ch1,'Enable','off');
   set(text_fltrdo_rechazo3_ch1,'Enable','off');
   set(editHndl.fltrdo_ws1_ch1,'Enable','off');
   set(editHndl.fltrdo_ws2_ch1,'Enable','off');
   set(text_fltrdo_rizo_s_ch1,'Enable','off');
   set(editHndl.fltrdo_rizo_s_ch1,'Enable','off');
else,  %El modo 2 de parámetros no acepta Bessel, ni necesita el tipo de fltrdo(pasobajo, pasoalto, ...)
   if fltrdo_algoritmo(filtroi(1),1)==3,%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      fltrdo_algoritmo(filtroi(1),1)=1;
      set(popup_fltrdo_algoritmo_ch1,'Value',1);
   end;
   set(popup_fltrdo_algoritmo_ch1,'String','Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   set(popup_fltrdo_tipo_ch1,'Enable','off');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(editHndl.fltrdo_orden_ch1,'Enable','off');
   set(editHndl.fltrdo_rizo_c_ch1,'Enable','off');
   set(editHndl.fltrdo_fc1_ch1,'Enable','off');
   set(editHndl.fltrdo_fc2_ch1,'Enable','off');
end;


%------------------------------------------------------------------------------------------
%---CANAL 2 -------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------

%---------------------------------------------------------------------------MARCO FILTRADO:
marco_fltrdo_ch2= uicontrol( ...
	'Style','frame', ...
   'Units','cent', ...
   'Position',[x1+.1 y2+.1 9.8 2.3], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES);
%-----------------------------------------------------------------Botón para elegir FILTRO:
Desactivar_Modo1_ch2=[...
      '  set(popup_fltrdo_tipo_ch2,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch2,''enable'',''off'');',...
      '  set(editHndl.fltrdo_orden_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_fc1_ch2,''enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch2,''Enable'',''off'');'];
Activar_Modo1_ch2=[...
      '  set(popup_fltrdo_tipo_ch2,''Enable'',''on'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch2,''enable'',''on'');',...
      '  set(editHndl.fltrdo_orden_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_c_ch2,''enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_c_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_fc1_ch2,''enable'',''on'');',...
      '  set(editHndl.fltrdo_fc1_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch2,''Enable'',''on'');'];
Activar_Modo2_ch2=[...
      '  set(text_fltrdo_paso1_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch2,''Enable'',''on'');'];
Desactivar_Modo2_ch2=[...
      '  set(text_fltrdo_paso1_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch2,''Enable'',''off'');'];
      
Accion_push_filtroi_ch2=['filtroi(2)=filtroi(2)+1;',...
      'if filtroi(2)>nmfltros, filtroi(2)=1; end;',...
      'set(pushHndl_filtroi_ch2,''String'',[''filtro '' num2str(filtroi(2))]);',...
      'set(popup_fltrdo_algoritmo_ch2,''Value'',fltrdo_algoritmo(filtroi(2),2));',... %Ningurno,Butterworth,...
      'set(popup_fltrdo_tipo_ch2,''Value'',fltrdo_tipo(filtroi(2),2));',... %pasobajo, pasoalto, pasobanda,...
      'set(pushHndl_modof_ch2,''string'',[''Modo '' num2str(modof(filtroi(2),2))]);',...
      'set(editHndl.fltrdo_orden_ch2,''String'',[fltrdo_orden(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_rizo_c_ch2,''String'',[fltrdo_rizo_c(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_fc1_ch2,''String'',[fltrdo_fc1(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_fc2_ch2,''String'',[fltrdo_fc2(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_wp1_ch2,''String'',[fltrdo_wp1(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_wp2_ch2,''String'',[fltrdo_wp2(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_rizo_p_ch2,''String'',[fltrdo_rizo_p(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_ws1_ch2,''String'',[fltrdo_ws1(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_ws2_ch2,''String'',[fltrdo_ws2(filtroi(2),2)]);',...
      'set(editHndl.fltrdo_rizo_s_ch2,''String'',[fltrdo_rizo_s(filtroi(2),2)]);',...%ACTIVACIONES:
      'if ((modof(filtroi(2),2)==1 & fltrdo_algoritmo(filtroi(2),2)>=7) | (modof(filtroi(2),2)==2 & fltrdo_algoritmo(filtroi(2),2)>=6)),',...%=>fdatool
      '',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '  set(pushHndl_modof_ch2,''Enable'',''off'');',...
      '  eval(Desactivar_Modo1_ch2);',...
      '  eval(Desactivar_Modo2_ch2);',...
      'else,',...%Se hacen activaciones en funcion de modof(filtroi(2),2)
      '  set(pushHndl_modof_ch2,''Enable'',''on'');',...
      '  set(popup_fltrdo_algoritmo_ch2,''Enable'',''on'');',... %Ninguno, Butterworth,...
      '  if modof(filtroi(2),2)==1,',...%Activamos los parametros del modo 1 y desactivamos los parametros del modo 2:
      '     set(popup_fltrdo_algoritmo_ch2,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Activar_Modo1_ch2);',...%Y desactivamos lo que haga falta en funcion del algoritmo:
      '     if (fltrdo_algoritmo(filtroi(2),2)<4 | fltrdo_algoritmo(filtroi(2),2)>6),',... %Inabilitación/Deshabilitación del rizo:
      '	      set(text_fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '        set(editHndl.fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '     end;',...
      '     if (fltrdo_tipo(filtroi(2),2)<3 | fltrdo_algoritmo(filtroi(2),2)>4),',...%Desabilitacion de fc2:
      '        set(editHndl.fltrdo_fc2_ch2,''enable'',''off'');',...%pasobajo y pasoalto no lo necesitan
      '     end;',...
      '     eval(Desactivar_Modo2_ch2);',...
      '  else, ',...%Activamos los parametros del modo 2 y desactivamos los parametros del modo 1:
      '     set(popup_fltrdo_algoritmo_ch2,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Desactivar_Modo1_ch2);',...
      '     eval(Activar_Modo2_ch2);',...
      '  end;',...
      'end;',...
      'PlotFiltro(filtroi(2),Nums.ch2,Dens.ch2,eje_filtro_ch2);'];

pushHndl_filtroi_ch2= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+.25 y2+1.8 2.25 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Conmuta entre los distintos filtros',...
   'String',['filtro ' num2str(filtroi(2))], ...
   'CallBack',Accion_push_filtroi_ch2); %Hace: eval(Accion_push_filtroi_ch2)

%-----------------------------------------------------Menú pop-up para elegir ALGORITMO de filtrado:
%Filtrando la señal, conseguimos que los metodos parametricos se 'concentren' en el
%ancho de banda deseado, ya que disminuimos la potencia de los posibles picos que 
%pueda haber fuera de dicho ancho de banda.

Accionpopup_fltrdo_algoritmo_ch2= [... %Habrá que tener en cuenta el modo de fltrdo(1 ó 2) pq el modo2 no acepta Bessel.
      'fltrdo_algoritmo(filtroi(2),2) = get(popup_fltrdo_algoritmo_ch2,''Value'');',...
      'if modof(filtroi(2),2)==1,'...%Modo 1 de fltrdo:Ninguno|Butter|Bessel|Cheb1|Cheb2|Elip|Cargar|Diseñar:
      '  if fltrdo_algoritmo(filtroi(2),2)>=7,',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '     set(pushHndl_modof_ch2,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch2);',...
      '     eval(Desactivar_Modo2_ch2);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch2,''Enable'',''on'');',...
      '     eval(Activar_Modo1_ch2);',...
	   '	   if (fltrdo_algoritmo(filtroi(2),2)>=4 & fltrdo_algoritmo(filtroi(2),2)<=6),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '	   end;',... 
      '     if fltrdo_tipo(filtroi(2),2)<=2,',...%Filtrados tipo pasobajo/pasoalto no usan la frecuencia fc2
      '        set(editHndl.fltrdo_fc2_ch2,''Enable'',''off'');',...
      '     end;',...
      '     eval(Desactivar_Modo2_ch2);',...
      '  end;',...
      '  [Nums.ch2,Dens.ch2]  =  NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
      'else,',...%modof(filtroi(2),2)==2;(El problema es que no hay bessel y los rangos de fltrdo_algoritmo cambian
      '  if fltrdo_algoritmo(filtroi(2),2)>=6,',...
      '     set(pushHndl_modof_ch2,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch2);',...
      '     eval(Desactivar_Modo2_ch2);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch2,''Enable'',''on'');',...
      '     eval(Activar_Modo2_ch2);',...
      '	   if (fltrdo_algoritmo(filtroi(2),2)>=3 & fltrdo_algoritmo(filtroi(2),2)<=5),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch2,''enable'',''off'');',...
      '	   end;',... 
      '  end;',...
      '	[Nums.ch2,Dens.ch2]  = NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      'end;',...
      'if (Num==1 & Den==1),',...%Sobretodo pensado por si hay un error al cargar un filtro
      '   fltrdo_algoritmo_ch2(filtroi(2),2)=1;',...
      '   set(popup_fltrdo_algoritmo_ch2,''Value'',1);',...
      'end;'];

popup_fltrdo_algoritmo_ch2 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+2.5 y2+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar', ...
   'ToolTipString','Elija el algoritmo de fltrdo',...
   'Value',fltrdo_algoritmo(filtroi(2),2), ...
   'CallBack',Accionpopup_fltrdo_algoritmo_ch2); 

%------------------------Menú pop-up para elegir filtro Paso-alto/Paso-bajo/Rechazo-Banda:
Accionpopup_fltrdo_tipo_ch2=['fltrdo_tipo(filtroi(2),2) = get(popup_fltrdo_tipo_ch2,''Value'');',...
      'if fltrdo_tipo(filtroi(2),2)<=2,',...%es pasobajo/pasoalto
      'set(editHndl.fltrdo_fc2_ch2,''enable'',''off'');',...
      'else,',...%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
      'set(editHndl.fltrdo_fc2_ch2,''enable'',''on'');',...
      'end;',...
      '[Nums.ch2,Dens.ch2] = NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
      ];

popup_fltrdo_tipo_ch2 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+4.8 y2+1.8 2.7 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Pasobajo|Pasoalto|PasoBanda|Rechazobanda', ...
   'ToolTipString','Elija el tipo de filtro',...
   'Value',fltrdo_tipo(filtroi(2),2), ...
   'CallBack',Accionpopup_fltrdo_tipo_ch2); 

%-----------------------------------------FILTROS SEGUN ORDEN/RIZADO/FRECUENCIAS DE CORTE:
%----------------------------------------------------------------------- Orden del filtro:
text_fltrdo_orden_ch2=uicontrol( ...
   'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y2+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Orden:', ...
   'ToolTipString','Orden del filtro');

Accion_fltrdo_orden_ch2=['fltrdo_orden(filtroi(2),2)=str2num(get(editHndl.fltrdo_orden_ch2,''String''));',...
      '[Nums.ch2,Dens.ch2] = NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
   ];
editHndl.fltrdo_orden_ch2 = uicontrol( ...  
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+1.15 y2+1.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_orden(filtroi(2),2)], ... 
   'ToolTipString','',...
   'CallBack',Accion_fltrdo_orden_ch2); 

%-------------------------------------------- Rizado en la banda de paso limitado por fc:
text_fltrdo_rizo_c_ch2=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+2 y2+1.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizado[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)');

Accion_fltrdo_rizo_c_ch2=['fltrdo_rizo_c(filtroi(2),2)=str2num(get(editHndl.fltrdo_rizo_c,''String''));',...
      '[Nums.ch2,Dens.ch2] = NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_rizo_c_ch2 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+3.6 y2+1.2 .8 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_c(filtroi(2),2)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)',...
    'CallBack',Accion_fltrdo_rizo_c_ch2); 
 
if (fltrdo_algoritmo(filtroi(2),2)>=3 & fltrdo_algoritmo(filtroi(2),2)<=4),
   set(editHndl.fltrdo_rizo_c_ch2,'enable','on');
   set(text_fltrdo_rizo_c_ch2,'enable','on');
else,
   set(editHndl.fltrdo_rizo_c_ch2,'enable','off');
   set(text_fltrdo_rizo_c_ch2,'enable','off')
end;

%--------------------------------------------------------Frecuencias de corte del filtro:
%Pueden especificarse una o dos frecuencias, dependiendo de si hablamos de un fltrdo
%pasoalto/pasobajo o pasobanda/rechazobanda.
%Para los filtros sin rizo, esta frecuencia es la frec. de 3dB de atenuacion, y para los
%filtros con rizo es la frecuencia de 'rizo' dB de atenuacion.
text_fltrdo_fc1_ch2=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+4.5 y2+1.2 3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','frecs. de corte[Hz]:fc1:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');

Accion_fltrdo_fc1_ch2=['fltrdo_fc1(filtroi(2),2)=str2num(get(editHndl.fltrdo_fc1_ch2,''String''));',...
      'if fltrdo_fc1(filtroi(2),2)>Fs/2, fltrdo_fc1(filtroi(2),2)=Fs/2; set(editHndl.fltrdo_fc1_ch2,''String'',[fltrdo_fc1(filtroi(2),2)]);',...
      'aviso(''Frecuencia de corte tiene que se menor que la de Nyquist''); end;',...
      '[Nums.ch2,Dens.ch2] = NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_fc1_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+7.4 y2+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc1(filtroi(2),2)], ... 
   'ToolTipString','Frecuencia de corte inferior del filtro(sin normalizar)',...
   'CallBack',Accion_fltrdo_fc1_ch2); 

text_fltrdo_fc2_ch2= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+8.3 y2+1.2 .5 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','fc2:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');
Accion_fltrdo_fc2_ch2= ['fltrdo_fc2(filtroi(2),2)=str2num(get(editHndl.fltrdo_fc2_ch2,''String''));',...
      'if fltrdo_fc2(filtroi(2),2)<=fltrdo_fc1(filtroi(2),2), fltrdo_fc1(filtroi(2),2)=1.1*fltrdo_fc2(filtroi(2),2); set(editHndl.fltrdo_fc2_ch2,''String'',[fltrdo_fc2(filtroi(2),2)]);',...
      'aviso(''Frecuencia de corte superior tiene que ser mayor que la inferior''); end;',...
      '[Nums.ch2,Dens.ch2] = NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_fc2_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y2+1.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc2(filtroi(2),2)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior del filtro sin normalizar',...
   'CallBack',Accion_fltrdo_fc2_ch2);

if fltrdo_tipo(filtroi(2),2)<=2,%es pasobajo/pasoalto
   set(editHndl.fltrdo_fc2_ch2,'enable','off');
else,%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
   set(editHndl.fltrdo_fc2_ch2,'enable','on');
end;

%---------------------------------------------------FILTROS SEGUN BANDAS DE PASO/RIZADOS:
%---------------------------------------------------------------Banda de Paso del filtro:
%Es la banda de paso del filtro, en la que habra un rizo maximo indicado por Rp(rizo
%en la banda de paso).
text_fltrdo_paso1_ch2=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y2+.7 2.9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de paso[Hz]=[', ...
   'ToolTipString','Banda de paso[fp1,fp2][Hz] del filtro');

Accion_fltrdo_wp1_ch2=['fltrdo_wp1(filtroi(2),2)=str2num(get(editHndl.fltrdo_wp1_ch2,''String''));',...
      'if (fltrdo_wp1(filtroi(2),2)>=fltrdo_wp2(filtroi(2),2) | fltrdo_wp1(filtroi(2),2)<=fltrdo_ws1(filtroi(2),2)),',...
      'fltrdo_wp1(filtroi(2),2)=min(1.1*fltrdo_ws1(filtroi(2),2),0.9*fltrdo_wp2(filtroi(2),2));',...
      'set(editHndl.fltrdo_wp1_ch2,''String'',[fltrdo_wp1(filtroi(2),2)]);',...
      'aviso(''f_paso1 debe quedar en (f_rechazo1,f_paso2).'');',...
      'end;',...
      '[Nums.ch2,Dens.ch2]= NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
   ];
editHndl.fltrdo_wp1_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.15 y2+.7 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp1(filtroi(2),2)], ... 
   'ToolTipString','Frecuencia de paso inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp1_ch2); 

text_fltrdo_paso2_ch2= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+3.95 y2+.7 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_wp2_ch2= ['fltrdo_wp2(filtroi(2),2)=str2num(get(editHndl.fltrdo_wp2_ch2,''String''));',...
      'if (fltrdo_wp2(filtroi(2),2)>=fltrdo_ws2(filtroi(2),2) | fltrdo_wp2(filtroi(2),2)<=fltrdo_wp1(filtroi(2),2)),',...
      '  fltrdo_wp2(filtroi(2),2)=max(1.1*fltrdo_wp1(filtroi(2),2),0.9*fltrdo_ws2(filtroi(2),2));',...
      '  set(editHndl.fltrdo_wp2_ch2,''String'',[fltrdo_wp2(filtroi(2),2)]);',...
      '  aviso(''f_paso2 debe quedar en (f_paso1,f_rechazo2).'');',...
      'end;',...
      '[Nums.ch2,Dens.ch2]= NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_wp2_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.1 y2+.7 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp2(filtroi(2),2)], ... 
   'ToolTipString','Frecuencia[Hz] de paso superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp2_ch2);

text_fltrdo_paso3_ch2= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.1 y2+.7 1.9 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] --------------->');

%------------------------------------- Rizado en la banda de paso limitado por [wp1,wp2]:
text_fltrdo_rizo_p_ch2= uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y2+.7 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de paso');

Accion_fltrdo_rizo_p_ch2= ['fltrdo_rizo_p(filtroi(2),2)=str2num(get(editHndl.fltrdo_rizo_p_ch2,''String''));',...
      '[Nums.ch2,Dens.ch2]= NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_rizo_p_ch2 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+8.8 y2+.7 1 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_p(filtroi(2),2)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso',...
    'CallBack',Accion_fltrdo_rizo_p_ch2); 
 
%------------------------------------------------Banda de Rechazo del filtro[ws1,ws2]:
%Es la banda de rechazo del filtro, en la que habra un rizo maximo indicado por 
%fltrdo_rizo_s(rizo en la banda de rechazo).
text_fltrdo_rechazo1_ch2= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y2+.2 3.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de rechazo[Hz]=[', ...
   'ToolTipString','Banda de rechazo[fs1,fs2][Hz] del filtro');

Accion_fltrdo_ws1_ch2= ['fltrdo_ws1(filtroi(2),2)=str2num(get(editHndl.fltrdo_ws1_ch2,''String''));',...
      'if (fltrdo_ws1(filtroi(2),2)>=fltrdo_wp1(filtroi(2),2) | fltrdo_ws1(filtroi(2),2)<=0),',...
      'fltrdo_ws1(filtroi(2),2)=max(.1,0.9*fltrdo_wp1(filtroi(2),2));',...
      'set(editHndl.fltrdo_ws1_ch2,''String'',[fltrdo_ws1(filtroi(2),2)]);',...
      'aviso(''f_rechazo1 debe quedar en (0,f_paso1).'');',...
      'end;',...
      '[Nums.ch2,Dens.ch2]= NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_ws1_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.45 y2+.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws1(filtroi(2),2)], ... 
   'ToolTipString','Frecuencia de corte inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws1_ch2); 

text_fltrdo_rechazo2_ch2=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+4.25 y2+.2 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_ws2_ch2=['fltrdo_ws2(filtroi(2),2)=str2num(get(editHndl.fltrdo_ws2_ch2,''String''));',...
      'if (fltrdo_ws2(filtroi(2),2)>=Fs/2 | fltrdo_ws2(filtroi(2),2)<=fltrdo_wp2(filtroi(2),2)),',...
      'fltrdo_ws2(filtroi(2),2)=min(1.1*fltrdo_wp2(filtroi(2),2),0.9*Fs/2);',...
      'set(editHndl.fltrdo_ws2_ch2,''String'',[fltrdo_ws2(filtroi(2),2)]);',...
      'aviso(''f_rechazo2 debe quedar en (f_paso2,Fs/2).'');',...
      'end;',...
      '[Nums.ch2,Dens.ch2]=NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_ws2_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.4 y2+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws2(filtroi(2),2)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws2_ch2);

text_fltrdo_rechazo3_ch2=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.4 y2+.2 1.6 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] ------------>');

%------------------------------------- Rizado en la banda de rechazo limitado por [ws1,ws2]:
text_fltrdo_rizo_s_ch2=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y2+.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de rechazo');

Accion_fltrdo_rizo_s_ch2=['fltrdo_rizo_s(filtroi(2),2)=str2num(get(editHndl.fltrdo_rizo_s_ch2,''String''));',...
      '[Nums.ch2,Dens.ch2]= NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      ];
editHndl.fltrdo_rizo_s_ch2 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y2+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_rizo_s(filtroi(2),2)], ...
   'ToolTipString','rizo[dB] del filtro en la banda de rechazo',...
   'CallBack',Accion_fltrdo_rizo_s_ch2);

%---------------------------------------------------------PLOT FILTRO(en Panel de Control)
%Para hacerlo, hay que esperar a tener todas las variables que pide.
Accion_eje_salida=[...
         'figure(2);',...
         'freqz(Nums.ch2(filtroi(2),:),Dens.ch2(filtroi(2),:),512,Fs);',...
         'title([''Filtro '' num2str(filtroi(2)) ]);',...
         'pulsador;',...
         'Numtotal=1;   Dentotal=1;',...%Esta funcion se llamara una vez terminado NumDenFiltro2,
         'for nf=1:nmfltros,',...%asi que habra que usar variables que existan en ese momento
         '  Numtotal=conv(Numtotal,Nums.ch2(nf,:));',...
         '  Dentotal=conv(Dentotal,Dens.ch2(nf,:));',...
         'end;',...
         'freqz(Numtotal,Dentotal,512,Fs);',...
         'title(''Filtro conjunto'');'];
eje_filtro_ch2= axes('Units','cent','Position',[.4 y2+.4 2 2],'ButtonDownFcn',Accion_eje_salida);
PlotFiltro(filtroi(2),Nums.ch2,Dens.ch2,eje_filtro_ch2); %Es una funcion.
%-------------------------------------------------------------------Boton MODO de filtrado:
%Sirve para conmutar entre la Forma 1 y la Forma 2 de calcular un filtro.
Accion_push_modof_ch2= [...
      'if modof(filtroi(2),2)==1,  modof(filtroi(2),2)=2;',...%Forma2=> Parametros(Wp=[wp1,wp2], Ws=[ws1,ws2], Rp, Rs)
      '  set(popup_fltrdo_algoritmo_ch2,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '  if fltrdo_algoritmo(filtroi(2),2)==3,',...%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      '     fltrdo_algoritmo(filtroi(2),2)= 1;	set(popup_fltrdo_algoritmo_ch2,''Value'',1);',...
      '  elseif fltrdo_algoritmo(filtroi(2),2)>3,',...%Hay  que restar 1 pq en modof(filtroi(2),2)==2, no hay Bessel
      '     fltrdo_algoritmo(filtroi(2),2)= fltrdo_algoritmo(filtroi(2),2) - 1;	set(popup_fltrdo_algoritmo_ch2,''Value'',fltrdo_algoritmo(filtroi(2),2));',...
      '  end;',...
      '  set(pushHndl_modof_ch2,''String'',''Modo 2'');',...%Quitamos el algoritmo de Bessel, q no puede hacerse asi:
      '  set(popup_fltrdo_tipo_ch2,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(editHndl.fltrdo_orden_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_paso1_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch2,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch2,''Enable'',''on'');',...
      '	[Nums.ch2,Dens.ch2] = NumDenFiltro2(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch2,Dens.ch2);',...
      'else,         modof(filtroi(2),2)=1;',...%Forma 1=> Parametros(orden,rizo,Wn)
      '  set(pushHndl_modof_ch2,''String'',''Modo 1'');',...
      '  set(popup_fltrdo_algoritmo_ch2,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');'...
      '  if fltrdo_algoritmo(filtroi(2),2)>2,',...%(3=>Chebyshev 1)Hay  que sumar 1 ya que en modof==1 si hay Bessel
      '     fltrdo_algoritmo(filtroi(2),2)= fltrdo_algoritmo(filtroi(2),2) + 1;	set(popup_fltrdo_algoritmo_ch2,''Value'',fltrdo_algoritmo(filtroi(2),2));',...
      '  end;',...
      '  set(popup_fltrdo_tipo_ch2,''Enable'',''on'',''Value'', fltrdo_tipo(filtroi(2),2));',...
      '  set(editHndl.fltrdo_orden_ch2,''Enable'',''on'');',...
      '  if (fltrdo_algoritmo(filtroi(2),2)>=4 & fltrdo_algoritmo(filtroi(2),2)<=6),',...
      '     set(editHndl.fltrdo_rizo_c_ch2,''enable'',''on'');',...
      '     set(text_fltrdo_rizo_c_ch2,''enable'',''on'');',...
      '  else,',...%Nada porque ya estan off
      '  end;',...
      '  set(editHndl.fltrdo_fc1_ch2,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch2,''Enable'',''on'');',...%Al ser siempre pasobanda, siempre se activa fc2 
      '  set(text_fltrdo_paso1_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch2,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch2,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch2,''Enable'',''off'');',...
      '  [Nums.ch2,Dens.ch2] = NumDenFiltro1(eje_filtro_ch2,filtroi(2),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch2,Dens.ch2);',...
      'end;'];
pushHndl_modof_ch2= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+7.5 y2+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Modo 1/2 de fltrdo',...
   'String',['Modo ' num2str(modof(filtroi(2),2))], ...
   'CallBack',Accion_push_modof_ch2);

%Al iniciar el programa, hay que adaptar el panel al valor de 'modof':
%NOTA: Al comienzo, todo esta 'on' solo hay que concentrarse en poner 'off':
if modof(filtroi(2),2)==1,
   set(popup_fltrdo_algoritmo_ch2,'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   %set(popup_fltrdo_tipo,'Enable','on');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(text_fltrdo_paso1_ch2,'Enable','off');
   set(text_fltrdo_paso2_ch2,'Enable','off');
   set(text_fltrdo_paso3_ch2,'Enable','off');
   set(editHndl.fltrdo_wp1_ch2,'Enable','off');
   set(editHndl.fltrdo_wp2_ch2,'Enable','off');
   set(text_fltrdo_rizo_p_ch2,'Enable','off');
   set(editHndl.fltrdo_rizo_p_ch2,'Enable','off');
   set(text_fltrdo_rechazo1_ch2,'Enable','off');
   set(text_fltrdo_rechazo2_ch2,'Enable','off');
   set(text_fltrdo_rechazo3_ch2,'Enable','off');
   set(editHndl.fltrdo_ws1_ch2,'Enable','off');
   set(editHndl.fltrdo_ws2_ch2,'Enable','off');
   set(text_fltrdo_rizo_s_ch2,'Enable','off');
   set(editHndl.fltrdo_rizo_s_ch2,'Enable','off');
else,  %El modo 2 de parámetros no acepta Bessel, ni necesita el tipo de fltrdo(pasobajo, pasoalto, ...)
   if fltrdo_algoritmo(filtroi(2),2)==3,%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      fltrdo_algoritmo(filtroi(2),2)=1;
      set(popup_fltrdo_algoritmo_ch2,'Value',1);
   end;
   set(popup_fltrdo_algoritmo_ch2,'String','Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   set(popup_fltrdo_tipo_ch2,'Enable','off');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(editHndl.fltrdo_orden_ch2,'Enable','off');
   set(editHndl.fltrdo_rizo_c_ch2,'Enable','off');
   set(editHndl.fltrdo_fc1_ch2,'Enable','off');
   set(editHndl.fltrdo_fc2_ch2,'Enable','off');
end;


%------------------------------------------------------------------------------------------
%---CANAL 3 -------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------

%---------------------------------------------------------------------------MARCO FILTRADO:
marco_fltrdo_ch3= uicontrol( ...
	'Style','frame', ...
   'Units','cent', ...
   'Position',[x1+.1 y3+.1 9.8 2.3], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES);
%-----------------------------------------------------------------Botón para elegir FILTRO:
Desactivar_Modo1_ch3=[...
      '  set(popup_fltrdo_tipo_ch3,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch3,''enable'',''off'');',...
      '  set(editHndl.fltrdo_orden_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_fc1_ch3,''enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch3,''Enable'',''off'');'];
Activar_Modo1_ch3=[...
      '  set(popup_fltrdo_tipo_ch3,''Enable'',''on'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch3,''enable'',''on'');',...
      '  set(editHndl.fltrdo_orden_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_c_ch3,''enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_c_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_fc1_ch3,''enable'',''on'');',...
      '  set(editHndl.fltrdo_fc1_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch3,''Enable'',''on'');'];
Activar_Modo2_ch3=[...
      '  set(text_fltrdo_paso1_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch3,''Enable'',''on'');'];
Desactivar_Modo2_ch3=[...
      '  set(text_fltrdo_paso1_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch3,''Enable'',''off'');'];
      
Accion_push_filtroi_ch3=['filtroi(3)=filtroi(3)+1;',...
      'if filtroi(3)>nmfltros, filtroi(3)=1; end;',...
      'set(pushHndl_filtroi_ch3,''String'',[''filtro '' num2str(filtroi(3))]);',...
      'set(popup_fltrdo_algoritmo_ch3,''Value'',fltrdo_algoritmo(filtroi(3),3));',... %Ningurno,Butterworth,...
      'set(popup_fltrdo_tipo_ch3,''Value'',fltrdo_tipo(filtroi(3),3));',... %pasobajo, pasoalto, pasobanda,...
      'set(pushHndl_modof_ch3,''string'',[''Modo '' num2str(modof(filtroi(3),3))]);',...
      'set(editHndl.fltrdo_orden_ch3,''String'',[fltrdo_orden(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_rizo_c_ch3,''String'',[fltrdo_rizo_c(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_fc1_ch3,''String'',[fltrdo_fc1(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_fc2_ch3,''String'',[fltrdo_fc2(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_wp1_ch3,''String'',[fltrdo_wp1(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_wp2_ch3,''String'',[fltrdo_wp2(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_rizo_p_ch3,''String'',[fltrdo_rizo_p(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_ws1_ch3,''String'',[fltrdo_ws1(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_ws2_ch3,''String'',[fltrdo_ws2(filtroi(3),3)]);',...
      'set(editHndl.fltrdo_rizo_s_ch3,''String'',[fltrdo_rizo_s(filtroi(3),3)]);',...%ACTIVACIONES:
      'if ((modof(filtroi(3),3)==1 & fltrdo_algoritmo(filtroi(3),3)>=7) | (modof(filtroi(3),3)==2 & fltrdo_algoritmo(filtroi(3),3)>=6)),',...%=>fdatool
      '',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '  set(pushHndl_modof_ch3,''Enable'',''off'');',...
      '  eval(Desactivar_Modo1_ch3);',...
      '  eval(Desactivar_Modo2_ch3);',...
      'else,',...%Se hacen activaciones en funcion de modof(filtroi(3),3)
      '  set(pushHndl_modof_ch3,''Enable'',''on'');',...
      '  set(popup_fltrdo_algoritmo_ch3,''Enable'',''on'');',... %Ninguno, Butterworth,...
      '  if modof(filtroi(3),3)==1,',...%Activamos los parametros del modo 1 y desactivamos los parametros del modo 2:
      '     set(popup_fltrdo_algoritmo_ch3,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Activar_Modo1_ch3);',...%Y desactivamos lo que haga falta en funcion del algoritmo:
      '     if (fltrdo_algoritmo(filtroi(3),3)<4 | fltrdo_algoritmo(filtroi(3),3)>6),',... %Inabilitación/Deshabilitación del rizo:
      '	      set(text_fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '        set(editHndl.fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '     end;',...
      '     if (fltrdo_tipo(filtroi(3),3)<3 | fltrdo_algoritmo(filtroi(3),3)>4),',...%Desabilitacion de fc2:
      '        set(editHndl.fltrdo_fc2_ch3,''enable'',''off'');',...%pasobajo y pasoalto no lo necesitan
      '     end;',...
      '     eval(Desactivar_Modo2_ch3);',...
      '  else, ',...%Activamos los parametros del modo 2 y desactivamos los parametros del modo 1:
      '     set(popup_fltrdo_algoritmo_ch3,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Desactivar_Modo1_ch3);',...
      '     eval(Activar_Modo2_ch3);',...
      '  end;',...
      'end;',...
      'PlotFiltro(filtroi(3),Nums.ch3,Dens.ch3,eje_filtro_ch3);'];

pushHndl_filtroi_ch3= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+.25 y3+1.8 2.25 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Conmuta entre los distintos filtros',...
   'String',['filtro ' num2str(filtroi(3))], ...
   'CallBack',Accion_push_filtroi_ch3); %Hace: eval(Accion_push_filtroi_ch3)

%-----------------------------------------------------Menú pop-up para elegir ALGORITMO de filtrado:
%Filtrando la señal, conseguimos que los metodos parametricos se 'concentren' en el
%ancho de banda deseado, ya que disminuimos la potencia de los posibles picos que 
%pueda haber fuera de dicho ancho de banda.

Accionpopup_fltrdo_algoritmo_ch3= [... %Habrá que tener en cuenta el modo de fltrdo(1 ó 2) pq el modo2 no acepta Bessel.
      'fltrdo_algoritmo(filtroi(3),3) = get(popup_fltrdo_algoritmo_ch3,''Value'');',...
      'if modof(filtroi(3),3)==1,'...%Modo 1 de fltrdo:Ninguno|Butter|Bessel|Cheb1|Cheb2|Elip|Cargar|Diseñar:
      '  if fltrdo_algoritmo(filtroi(3),3)>=7,',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '     set(pushHndl_modof_ch3,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch3);',...
      '     eval(Desactivar_Modo2_ch3);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch3,''Enable'',''on'');',...
      '     eval(Activar_Modo1_ch3);',...
	   '	   if (fltrdo_algoritmo(filtroi(3),3)>=4 & fltrdo_algoritmo(filtroi(3),3)<=6),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '	   end;',... 
      '     if fltrdo_tipo(filtroi(3),3)<=2,',...%Filtrados tipo pasobajo/pasoalto no usan la frecuencia fc2
      '        set(editHndl.fltrdo_fc2_ch3,''Enable'',''off'');',...
      '     end;',...
      '     eval(Desactivar_Modo2_ch3);',...
      '  end;',...
      '  [Nums.ch3,Dens.ch3]  =  NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),fltrdo_orden(:,3),fltrdo_rizo_c(:,3),fltrdo_tipo(:,3),[fltrdo_fc1(:,3) fltrdo_fc2(:,3)]/(Fs/2),Nums.ch3,Dens.ch3);',...
      'else,',...%modof(filtroi(3),3)==2;(El problema es que no hay bessel y los rangos de fltrdo_algoritmo cambian
      '  if fltrdo_algoritmo(filtroi(3),3)>=6,',...
      '     set(pushHndl_modof_ch3,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch3);',...
      '     eval(Desactivar_Modo2_ch3);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch3,''Enable'',''on'');',...
      '     eval(Activar_Modo2_ch3);',...
      '	   if (fltrdo_algoritmo(filtroi(3),3)>=3 & fltrdo_algoritmo(filtroi(3),3)<=5),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch3,''enable'',''off'');',...
      '	   end;',... 
      '  end;',...
      '	[Nums.ch3,Dens.ch3]  = NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),[fltrdo_wp1(:,3) fltrdo_wp2(:,3)]/(Fs/2),[fltrdo_ws1(:,3) fltrdo_ws2(:,3)]/(Fs/2),fltrdo_rizo_p(:,3),fltrdo_rizo_s(:,3),Nums.ch3,Dens.ch3);',...
      'end;',...
      'if (Num==1 & Den==1),',...%Sobretodo pensado por si hay un error al cargar un filtro
      '   fltrdo_algoritmo_ch3(filtroi(3),3)=1;',...
      '   set(popup_fltrdo_algoritmo_ch3,''Value'',1);',...
      'end;'];

popup_fltrdo_algoritmo_ch3 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+2.5 y3+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar', ...
   'ToolTipString','Elija el algoritmo de fltrdo',...
   'Value',fltrdo_algoritmo(filtroi(3),3), ...
   'CallBack',Accionpopup_fltrdo_algoritmo_ch3); 

%------------------------Menú pop-up para elegir filtro Paso-alto/Paso-bajo/Rechazo-Banda:
Accionpopup_fltrdo_tipo_ch3=['fltrdo_tipo(filtroi(3),3) = get(popup_fltrdo_tipo_ch3,''Value'');',...
      'if fltrdo_tipo(filtroi(3),3)<=2,',...%es pasobajo/pasoalto
      'set(editHndl.fltrdo_fc2_ch3,''enable'',''off'');',...
      'else,',...%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
      'set(editHndl.fltrdo_fc2_ch3,''enable'',''on'');',...
      'end;',...
      '[Nums.ch3,Dens.ch3] = NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),fltrdo_orden(:,3),fltrdo_rizo_c(:,3),fltrdo_tipo(:,3),[fltrdo_fc1(:,3) fltrdo_fc2(:,3)]/(Fs/2),Nums.ch3,Dens.ch3);',...
      ];

popup_fltrdo_tipo_ch3 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+4.8 y3+1.8 2.7 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Pasobajo|Pasoalto|PasoBanda|Rechazobanda', ...
   'ToolTipString','Elija el tipo de filtro',...
   'Value',fltrdo_tipo(filtroi(3),3), ...
   'CallBack',Accionpopup_fltrdo_tipo_ch3); 

%-----------------------------------------FILTROS SEGUN ORDEN/RIZADO/FRECUENCIAS DE CORTE:
%----------------------------------------------------------------------- Orden del filtro:
text_fltrdo_orden_ch3=uicontrol( ...
   'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y3+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Orden:', ...
   'ToolTipString','Orden del filtro');

Accion_fltrdo_orden_ch3=['fltrdo_orden(filtroi(3),3)=str2num(get(editHndl.fltrdo_orden_ch3,''String''));',...
      '[Nums.ch3,Dens.ch3] = NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),fltrdo_orden(:,3),fltrdo_rizo_c(:,3),fltrdo_tipo(:,3),[fltrdo_fc1(:,3) fltrdo_fc2(:,3)]/(Fs/2),Nums.ch3,Dens.ch3);',...
   ];
editHndl.fltrdo_orden_ch3 = uicontrol( ...  
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+1.15 y3+1.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_orden(filtroi(3),3)], ... 
   'ToolTipString','',...
   'CallBack',Accion_fltrdo_orden_ch3); 

%-------------------------------------------- Rizado en la banda de paso limitado por fc:
text_fltrdo_rizo_c_ch3=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+2 y3+1.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizado[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)');

Accion_fltrdo_rizo_c_ch3=['fltrdo_rizo_c(filtroi(3),3)=str2num(get(editHndl.fltrdo_rizo_c,''String''));',...
      '[Nums.ch3,Dens.ch3] = NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),fltrdo_orden(:,3),fltrdo_rizo_c(:,3),fltrdo_tipo(:,3),[fltrdo_fc1(:,3) fltrdo_fc2(:,3)]/(Fs/2),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_rizo_c_ch3 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+3.6 y3+1.2 .8 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_c(filtroi(3),3)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)',...
    'CallBack',Accion_fltrdo_rizo_c_ch3); 
 
if (fltrdo_algoritmo(filtroi(3),3)>=3 & fltrdo_algoritmo(filtroi(3),3)<=4),
   set(editHndl.fltrdo_rizo_c_ch3,'enable','on');
   set(text_fltrdo_rizo_c_ch3,'enable','on');
else,
   set(editHndl.fltrdo_rizo_c_ch3,'enable','off');
   set(text_fltrdo_rizo_c_ch3,'enable','off')
end;

%--------------------------------------------------------Frecuencias de corte del filtro:
%Pueden especificarse una o dos frecuencias, dependiendo de si hablamos de un fltrdo
%pasoalto/pasobajo o pasobanda/rechazobanda.
%Para los filtros sin rizo, esta frecuencia es la frec. de 3dB de atenuacion, y para los
%filtros con rizo es la frecuencia de 'rizo' dB de atenuacion.
text_fltrdo_fc1_ch3=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+4.5 y3+1.2 3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','frecs. de corte[Hz]:fc1:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');

Accion_fltrdo_fc1_ch3=['fltrdo_fc1(filtroi(3),3)=str2num(get(editHndl.fltrdo_fc1_ch3,''String''));',...
      'if fltrdo_fc1(filtroi(3),3)>Fs/2, fltrdo_fc1(filtroi(3),3)=Fs/2; set(editHndl.fltrdo_fc1_ch3,''String'',[fltrdo_fc1(filtroi(3),3)]);',...
      'aviso(''Frecuencia de corte tiene que se menor que la de Nyquist''); end;',...
      '[Nums.ch3,Dens.ch3] = NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),fltrdo_orden(:,3),fltrdo_rizo_c(:,3),fltrdo_tipo(:,3),[fltrdo_fc1(:,3) fltrdo_fc2(:,3)]/(Fs/2),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_fc1_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+7.4 y3+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc1(filtroi(3),3)], ... 
   'ToolTipString','Frecuencia de corte inferior del filtro(sin normalizar)',...
   'CallBack',Accion_fltrdo_fc1_ch3); 

text_fltrdo_fc2_ch3= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+8.3 y3+1.2 .5 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','fc2:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');
Accion_fltrdo_fc2_ch3= ['fltrdo_fc2(filtroi(3),3)=str2num(get(editHndl.fltrdo_fc2_ch3,''String''));',...
      'if fltrdo_fc2(filtroi(3),3)<=fltrdo_fc1(filtroi(3),3), fltrdo_fc1(filtroi(3),3)=1.1*fltrdo_fc2(filtroi(3),3); set(editHndl.fltrdo_fc2_ch3,''String'',[fltrdo_fc2(filtroi(3),3)]);',...
      'aviso(''Frecuencia de corte superior tiene que ser mayor que la inferior''); end;',...
      '[Nums.ch3,Dens.ch3] = NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),fltrdo_orden(:,3),fltrdo_rizo_c(:,3),fltrdo_tipo(:,3),[fltrdo_fc1(:,3) fltrdo_fc2(:,3)]/(Fs/2),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_fc2_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y3+1.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc2(filtroi(3),3)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior del filtro sin normalizar',...
   'CallBack',Accion_fltrdo_fc2_ch3);

if fltrdo_tipo(filtroi(3),3)<=2,%es pasobajo/pasoalto
   set(editHndl.fltrdo_fc2_ch3,'enable','off');
else,%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
   set(editHndl.fltrdo_fc2_ch3,'enable','on');
end;

%---------------------------------------------------FILTROS SEGUN BANDAS DE PASO/RIZADOS:
%---------------------------------------------------------------Banda de Paso del filtro:
%Es la banda de paso del filtro, en la que habra un rizo maximo indicado por Rp(rizo
%en la banda de paso).
text_fltrdo_paso1_ch3=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y3+.7 2.9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de paso[Hz]=[', ...
   'ToolTipString','Banda de paso[fp1,fp2][Hz] del filtro');

Accion_fltrdo_wp1_ch3=['fltrdo_wp1(filtroi(3),3)=str2num(get(editHndl.fltrdo_wp1_ch3,''String''));',...
      'if (fltrdo_wp1(filtroi(3),3)>=fltrdo_wp2(filtroi(3),3) | fltrdo_wp1(filtroi(3),3)<=fltrdo_ws1(filtroi(3),3)),',...
      'fltrdo_wp1(filtroi(3),3)=min(1.1*fltrdo_ws1(filtroi(3),3),0.9*fltrdo_wp2(filtroi(3),3));',...
      'set(editHndl.fltrdo_wp1_ch3,''String'',[fltrdo_wp1(filtroi(3),3)]);',...
      'aviso(''f_paso1 debe quedar en (f_rechazo1,f_paso2).'');',...
      'end;',...
      '[Nums.ch3,Dens.ch3]= NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),[fltrdo_wp1(:,3) fltrdo_wp2(:,3)]/(Fs/2),[fltrdo_ws1(:,3) fltrdo_ws2(:,3)]/(Fs/2),fltrdo_rizo_p(:,3),fltrdo_rizo_s(:,3),Nums.ch3,Dens.ch3);',...
   ];
editHndl.fltrdo_wp1_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.15 y3+.7 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp1(filtroi(3),3)], ... 
   'ToolTipString','Frecuencia de paso inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp1_ch3); 

text_fltrdo_paso2_ch3= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+3.95 y3+.7 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_wp2_ch3= ['fltrdo_wp2(filtroi(3),3)=str2num(get(editHndl.fltrdo_wp2_ch3,''String''));',...
      'if (fltrdo_wp2(filtroi(3),3)>=fltrdo_ws2(filtroi(3),3) | fltrdo_wp2(filtroi(3),3)<=fltrdo_wp1(filtroi(3),3)),',...
      'fltrdo_wp2(filtroi(3),3)=max(1.1*fltrdo_wp1(filtroi(3),3),0.9*fltrdo_ws2(filtroi(3),3));',...
      'set(editHndl.fltrdo_wp2_ch3,''String'',[fltrdo_wp2(filtroi(3),3)]);',...
      'aviso(''f_paso2 debe quedar en (f_paso1,f_rechazo2).'');',...
      'end;',...
      '[Nums.ch3,Dens.ch3]= NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),[fltrdo_wp1(:,3) fltrdo_wp2(:,3)]/(Fs/2),[fltrdo_ws1(:,3) fltrdo_ws2(:,3)]/(Fs/2),fltrdo_rizo_p(:,3),fltrdo_rizo_s(:,3),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_wp2_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.1 y3+.7 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp2(filtroi(3),3)], ... 
   'ToolTipString','Frecuencia[Hz] de paso superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp2_ch3);

text_fltrdo_paso3_ch3= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.1 y3+.7 1.9 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] --------------->');

%------------------------------------- Rizado en la banda de paso limitado por [wp1,wp2]:
text_fltrdo_rizo_p_ch3= uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y3+.7 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de paso');

Accion_fltrdo_rizo_p_ch3= ['fltrdo_rizo_p(filtroi(3),3)=str2num(get(editHndl.fltrdo_rizo_p_ch3,''String''));',...
      '[Nums.ch3,Dens.ch3]= NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),[fltrdo_wp1(:,3) fltrdo_wp2(:,3)]/(Fs/2),[fltrdo_ws1(:,3) fltrdo_ws2(:,3)]/(Fs/2),fltrdo_rizo_p(:,3),fltrdo_rizo_s(:,3),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_rizo_p_ch3 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+8.8 y3+.7 1 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_p(filtroi(3),3)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso',...
    'CallBack',Accion_fltrdo_rizo_p_ch3); 
 
%------------------------------------------------Banda de Rechazo del filtro[ws1,ws2]:
%Es la banda de rechazo del filtro, en la que habra un rizo maximo indicado por 
%fltrdo_rizo_s(rizo en la banda de rechazo).
text_fltrdo_rechazo1_ch3= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y3+.2 3.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de rechazo[Hz]=[', ...
   'ToolTipString','Banda de rechazo[fs1,fs2][Hz] del filtro');

Accion_fltrdo_ws1_ch3= ['fltrdo_ws1(filtroi(3),3)=str2num(get(editHndl.fltrdo_ws1_ch3,''String''));',...
      'if (fltrdo_ws1(filtroi(3),3)>=fltrdo_wp1(filtroi(3),3) | fltrdo_ws1(filtroi(3),3)<=0),',...
      'fltrdo_ws1(filtroi(3),3)=max(.1,0.9*fltrdo_wp1(filtroi(3),3));',...
      'set(editHndl.fltrdo_ws1_ch3,''String'',[fltrdo_ws1(filtroi(3),3)]);',...
      'aviso(''f_rechazo1 debe quedar en (0,f_paso1).'');',...
      'end;',...
      '[Nums.ch3,Dens.ch3]= NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),[fltrdo_wp1(:,3) fltrdo_wp2(:,3)]/(Fs/2),[fltrdo_ws1(:,3) fltrdo_ws2(:,3)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_ws1_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.45 y3+.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws1(filtroi(3),2)], ... 
   'ToolTipString','Frecuencia de corte inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws1_ch3); 

text_fltrdo_rechazo2_ch3=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+4.25 y3+.2 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_ws2_ch3=['fltrdo_ws2(filtroi(3),3)=str2num(get(editHndl.fltrdo_ws2_ch3,''String''));',...
      'if (fltrdo_ws2(filtroi(3),3)>=Fs/2 | fltrdo_ws2(filtroi(3),3)<=fltrdo_wp2(filtroi(3),3)),',...
      'fltrdo_ws2(filtroi(3),3)=min(1.1*fltrdo_wp2(filtroi(3),3),0.9*Fs/2);',...
      'set(editHndl.fltrdo_ws2_ch3,''String'',[fltrdo_ws2(filtroi(3),3)]);',...
      'aviso(''f_rechazo2 debe quedar en (f_paso2,Fs/2).'');',...
      'end;',...
      '[Nums.ch3,Dens.ch3]=NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,3),[fltrdo_wp1(:,3) fltrdo_wp2(:,3)]/(Fs/2),[fltrdo_ws1(:,3) fltrdo_ws2(:,3)]/(Fs/2),fltrdo_rizo_p(:,3),fltrdo_rizo_s(:,3),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_ws2_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.4 y3+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws2(filtroi(3),2)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws2_ch3);

text_fltrdo_rechazo3_ch3=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.4 y3+.2 1.6 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] ------------>');

%------------------------------------- Rizado en la banda de rechazo limitado por [ws1,ws2]:
text_fltrdo_rizo_s_ch3=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y3+.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de rechazo');

Accion_fltrdo_rizo_s_ch3=['fltrdo_rizo_s(filtroi(3),2)=str2num(get(editHndl.fltrdo_rizo_s_ch3,''String''));',...
      '[Nums.ch3,Dens.ch3]= NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch3,Dens.ch3);',...
      ];
editHndl.fltrdo_rizo_s_ch3 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y3+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_rizo_s(filtroi(3),2)], ...
   'ToolTipString','rizo[dB] del filtro en la banda de rechazo',...
   'CallBack',Accion_fltrdo_rizo_s_ch3);

%---------------------------------------------------------PLOT FILTRO(en Panel de Control)
%Para hacerlo, hay que esperar a tener todas las variables que pide.
Accion_eje_salida=[...
         'figure(3);',...
         'freqz(Nums.ch3(filtroi(3),:),Dens.ch3(filtroi(3),:),512,Fs);',...
         'title([''Filtro '' num2str(filtroi(3)) ]);',...
         'pulsador;',...
         'Numtotal=1;   Dentotal=1;',...%Esta funcion se llamara una vez terminado NumDenFiltro2,
         'for nf=1:nmfltros,',...%asi que habra que usar variables que existan en ese momento
         '  Numtotal=conv(Numtotal,Nums.ch3(nf,:));',...
         '  Dentotal=conv(Dentotal,Dens.ch3(nf,:));',...
         'end;',...
         'freqz(Numtotal,Dentotal,512,Fs);',...
         'title(''Filtro conjunto'');'];
eje_filtro_ch3= axes('Units','cent','Position',[.4 y3+.4 2 2],'ButtonDownFcn',Accion_eje_salida);
PlotFiltro(filtroi(3),Nums.ch3,Dens.ch3,eje_filtro_ch3); %Es una funcion.
%-------------------------------------------------------------------Boton MODO de filtrado:
%Sirve para conmutar entre la Forma 1 y la Forma 2 de calcular un filtro.
Accion_push_modof_ch3= [...
      'if modof(filtroi(3),2)==1,  modof(filtroi(3),2)=2;',...%Forma2=> Parametros(Wp=[wp1,wp2], Ws=[ws1,ws2], Rp, Rs)
      '  set(popup_fltrdo_algoritmo_ch3,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '  if fltrdo_algoritmo(filtroi(3),2)==3,',...%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      '     fltrdo_algoritmo(filtroi(3),2)= 1;	set(popup_fltrdo_algoritmo_ch3,''Value'',1);',...
      '  elseif fltrdo_algoritmo(filtroi(3),2)>3,',...%Hay  que restar 1 pq en modof(filtroi(3),2)==2, no hay Bessel
      '     fltrdo_algoritmo(filtroi(3),2)= fltrdo_algoritmo(filtroi(3),2) - 1;	set(popup_fltrdo_algoritmo_ch3,''Value'',fltrdo_algoritmo(filtroi(3),2));',...
      '  end;',...
      '  set(pushHndl_modof_ch3,''String'',''Modo 2'');',...%Quitamos el algoritmo de Bessel, q no puede hacerse asi:
      '  set(popup_fltrdo_tipo_ch3,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(editHndl.fltrdo_orden_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_paso1_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch3,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch3,''Enable'',''on'');',...
      '	[Nums.ch3,Dens.ch3] = NumDenFiltro2(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,2),[fltrdo_wp1(:,2) fltrdo_wp2(:,2)]/(Fs/2),[fltrdo_ws1(:,2) fltrdo_ws2(:,2)]/(Fs/2),fltrdo_rizo_p(:,2),fltrdo_rizo_s(:,2),Nums.ch3,Dens.ch3);',...
      'else,         modof(filtroi(3),2)=1;',...%Forma 1=> Parametros(orden,rizo,Wn)
      '  set(pushHndl_modof_ch3,''String'',''Modo 1'');',...
      '  set(popup_fltrdo_algoritmo_ch3,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');'...
      '  if fltrdo_algoritmo(filtroi(3),2)>2,',...%(3=>Chebyshev 1)Hay  que sumar 1 ya que en modof==1 si hay Bessel
      '     fltrdo_algoritmo(filtroi(3),2)= fltrdo_algoritmo(filtroi(3),2) + 1;	set(popup_fltrdo_algoritmo_ch3,''Value'',fltrdo_algoritmo(filtroi(3),2));',...
      '  end;',...
      '  set(popup_fltrdo_tipo_ch3,''Enable'',''on'',''Value'', fltrdo_tipo(filtroi(3),2));',...
      '  set(editHndl.fltrdo_orden_ch3,''Enable'',''on'');',...
      '  if (fltrdo_algoritmo(filtroi(3),2)>=4 & fltrdo_algoritmo(filtroi(3),2)<=6),',...
      '     set(editHndl.fltrdo_rizo_c_ch3,''enable'',''on'');',...
      '     set(text_fltrdo_rizo_c_ch3,''enable'',''on'');',...
      '  else,',...%Nada porque ya estan off
      '  end;',...
      '  set(editHndl.fltrdo_fc1_ch3,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch3,''Enable'',''on'');',...%Al ser siempre pasobanda, siempre se activa fc2 
      '  set(text_fltrdo_paso1_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch3,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch3,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch3,''Enable'',''off'');',...
      '  [Nums.ch3,Dens.ch3] = NumDenFiltro1(eje_filtro_ch3,filtroi(3),fltrdo_algoritmo(:,2),fltrdo_orden(:,2),fltrdo_rizo_c(:,2),fltrdo_tipo(:,2),[fltrdo_fc1(:,2) fltrdo_fc2(:,2)]/(Fs/2),Nums.ch3,Dens.ch3);',...
      'end;'];
pushHndl_modof_ch3= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+7.5 y3+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Modo 1/2 de fltrdo',...
   'String',['Modo ' num2str(modof(filtroi(3),2))], ...
   'CallBack',Accion_push_modof_ch3);

%Al iniciar el programa, hay que adaptar el panel al valor de 'modof':
%NOTA: Al comienzo, todo esta 'on' solo hay que concentrarse en poner 'off':
if modof(filtroi(3),2)==1,
   set(popup_fltrdo_algoritmo_ch3,'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   %set(popup_fltrdo_tipo,'Enable','on');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(text_fltrdo_paso1_ch3,'Enable','off');
   set(text_fltrdo_paso2_ch3,'Enable','off');
   set(text_fltrdo_paso3_ch3,'Enable','off');
   set(editHndl.fltrdo_wp1_ch3,'Enable','off');
   set(editHndl.fltrdo_wp2_ch3,'Enable','off');
   set(text_fltrdo_rizo_p_ch3,'Enable','off');
   set(editHndl.fltrdo_rizo_p_ch3,'Enable','off');
   set(text_fltrdo_rechazo1_ch3,'Enable','off');
   set(text_fltrdo_rechazo2_ch3,'Enable','off');
   set(text_fltrdo_rechazo3_ch3,'Enable','off');
   set(editHndl.fltrdo_ws1_ch3,'Enable','off');
   set(editHndl.fltrdo_ws2_ch3,'Enable','off');
   set(text_fltrdo_rizo_s_ch3,'Enable','off');
   set(editHndl.fltrdo_rizo_s_ch3,'Enable','off');
else,  %El modo 2 de parámetros no acepta Bessel, ni necesita el tipo de fltrdo(pasobajo, pasoalto, ...)
   if fltrdo_algoritmo(filtroi(3),2)==3,%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      fltrdo_algoritmo(filtroi(3),2)=1;
      set(popup_fltrdo_algoritmo_ch3,'Value',1);
   end;
   set(popup_fltrdo_algoritmo_ch3,'String','Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   set(popup_fltrdo_tipo_ch3,'Enable','off');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(editHndl.fltrdo_orden_ch3,'Enable','off');
   set(editHndl.fltrdo_rizo_c_ch3,'Enable','off');
   set(editHndl.fltrdo_fc1_ch3,'Enable','off');
   set(editHndl.fltrdo_fc2_ch3,'Enable','off');
end;



%------------------------------------------------------------------------------------------
%---CANAL 4 -------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------

%---------------------------------------------------------------------------MARCO FILTRADO:
marco_fltrdo_ch4= uicontrol( ...
	'Style','frame', ...
   'Units','cent', ...
   'Position',[x1+.1 y4+.1 9.8 2.3], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES);
%-----------------------------------------------------------------Botón para elegir FILTRO:
Desactivar_Modo1_ch4=[...
      '  set(popup_fltrdo_tipo_ch4,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch4,''enable'',''off'');',...
      '  set(editHndl.fltrdo_orden_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_fc1_ch4,''enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch4,''Enable'',''off'');'];
Activar_Modo1_ch4=[...
      '  set(popup_fltrdo_tipo_ch4,''Enable'',''on'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(text_fltrdo_orden_ch4,''enable'',''on'');',...
      '  set(editHndl.fltrdo_orden_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_c_ch4,''enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_c_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_fc1_ch4,''enable'',''on'');',...
      '  set(editHndl.fltrdo_fc1_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch4,''Enable'',''on'');'];
Activar_Modo2_ch4=[...
      '  set(text_fltrdo_paso1_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch4,''Enable'',''on'');'];
Desactivar_Modo2_ch4=[...
      '  set(text_fltrdo_paso1_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch4,''Enable'',''off'');'];
      
Accion_push_filtroi_ch4=['filtroi(4)=filtroi(4)+1;',...
      'if filtroi(4)>nmfltros, filtroi(4)=1; end;',...
      'set(pushHndl_filtroi_ch4,''String'',[''filtro '' num2str(filtroi(4))]);',...
      'set(popup_fltrdo_algoritmo_ch4,''Value'',fltrdo_algoritmo(filtroi(4),4));',... %Ningurno,Butterworth,...
      'set(popup_fltrdo_tipo_ch4,''Value'',fltrdo_tipo(filtroi(4),4));',... %pasobajo, pasoalto, pasobanda,...
      'set(pushHndl_modof_ch4,''string'',[''Modo '' num2str(modof(filtroi(4),4))]);',...
      'set(editHndl.fltrdo_orden_ch4,''String'',[fltrdo_orden(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_rizo_c_ch4,''String'',[fltrdo_rizo_c(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_fc1_ch4,''String'',[fltrdo_fc1(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_fc2_ch4,''String'',[fltrdo_fc2(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_wp1_ch4,''String'',[fltrdo_wp1(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_wp2_ch4,''String'',[fltrdo_wp2(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_rizo_p_ch4,''String'',[fltrdo_rizo_p(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_ws1_ch4,''String'',[fltrdo_ws1(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_ws2_ch4,''String'',[fltrdo_ws2(filtroi(4),4)]);',...
      'set(editHndl.fltrdo_rizo_s_ch4,''String'',[fltrdo_rizo_s(filtroi(4),4)]);',...%ACTIVACIONES:
      'if ((modof(filtroi(4),4)==1 & fltrdo_algoritmo(filtroi(4),4)>=7) | (modof(filtroi(4),4)==2 & fltrdo_algoritmo(filtroi(4),4)>=6)),',...%=>fdatool
      '',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '  set(pushHndl_modof_ch4,''Enable'',''off'');',...
      '  eval(Desactivar_Modo1_ch4);',...
      '  eval(Desactivar_Modo2_ch4);',...
      'else,',...%Se hacen activaciones en funcion de modof(filtroi(4),4)
      '  set(pushHndl_modof_ch4,''Enable'',''on'');',...
      '  set(popup_fltrdo_algoritmo_ch4,''Enable'',''on'');',... %Ninguno, Butterworth,...
      '  if modof(filtroi(4),4)==1,',...%Activamos los parametros del modo 1 y desactivamos los parametros del modo 2:
      '     set(popup_fltrdo_algoritmo_ch4,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Activar_Modo1_ch4);',...%Y desactivamos lo que haga falta en funcion del algoritmo:
      '     if (fltrdo_algoritmo(filtroi(4),4)<4 | fltrdo_algoritmo(filtroi(4),4)>6),',... %Inabilitación/Deshabilitación del rizo:
      '	      set(text_fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '        set(editHndl.fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '     end;',...
      '     if (fltrdo_tipo(filtroi(4),4)<3 | fltrdo_algoritmo(filtroi(4),4)>4),',...%Desabilitacion de fc2:
      '        set(editHndl.fltrdo_fc2_ch4,''enable'',''off'');',...%pasobajo y pasoalto no lo necesitan
      '     end;',...
      '     eval(Desactivar_Modo2_ch4);',...
      '  else, ',...%Activamos los parametros del modo 2 y desactivamos los parametros del modo 1:
      '     set(popup_fltrdo_algoritmo_ch4,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '     eval(Desactivar_Modo1_ch4);',...
      '     eval(Activar_Modo2_ch4);',...
      '  end;',...
      'end;',...
      'PlotFiltro(filtroi(4),Nums.ch4,Dens.ch4,eje_filtro_ch4);'];

pushHndl_filtroi_ch4= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+.25 y4+1.8 2.25 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Conmuta entre los distintos filtros',...
   'String',['filtro ' num2str(filtroi(4))], ...
   'CallBack',Accion_push_filtroi_ch4); %Hace: eval(Accion_push_filtroi_ch4)

%-----------------------------------------------------Menú pop-up para elegir ALGORITMO de filtrado:
%Filtrando la señal, conseguimos que los metodos parametricos se 'concentren' en el
%ancho de banda deseado, ya que disminuimos la potencia de los posibles picos que 
%pueda haber fuera de dicho ancho de banda.

Accionpopup_fltrdo_algoritmo_ch4= [... %Habrá que tener en cuenta el modo de fltrdo(1 ó 2) pq el modo2 no acepta Bessel.
      'fltrdo_algoritmo(filtroi(4),4) = get(popup_fltrdo_algoritmo_ch4,''Value'');',...
      'if modof(filtroi(4),4)==1,'...%Modo 1 de fltrdo:Ninguno|Butter|Bessel|Cheb1|Cheb2|Elip|Cargar|Diseñar:
      '  if fltrdo_algoritmo(filtroi(4),4)>=7,',...%Casos 'Cargar' y 'Diseñar' ==> Desactivamos todo:
      '     set(pushHndl_modof_ch4,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch4);',...
      '     eval(Desactivar_Modo2_ch4);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch4,''Enable'',''on'');',...
      '     eval(Activar_Modo1_ch4);',...
	   '	   if (fltrdo_algoritmo(filtroi(4),4)>=4 & fltrdo_algoritmo(filtroi(4),4)<=6),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '	   end;',... 
      '     if fltrdo_tipo(filtroi(4),4)<=2,',...%Filtrados tipo pasobajo/pasoalto no usan la frecuencia fc2
      '        set(editHndl.fltrdo_fc2_ch4,''Enable'',''off'');',...
      '     end;',...
      '     eval(Desactivar_Modo2_ch4);',...
      '  end;',...
      '  [Nums.ch4,Dens.ch4]  =  NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
      'else,',...%modof(filtroi(4),4)==2;(El problema es que no hay bessel y los rangos de fltrdo_algoritmo cambian
      '  if fltrdo_algoritmo(filtroi(4),4)>=6,',...
      '     set(pushHndl_modof_ch4,''Enable'',''off'');',...
      '     eval(Desactivar_Modo1_ch4);',...
      '     eval(Desactivar_Modo2_ch4);',...
      '  else,',...%Casos 'normales'
      '     set(pushHndl_modof_ch4,''Enable'',''on'');',...
      '     eval(Activar_Modo2_ch4);',...
      '	   if (fltrdo_algoritmo(filtroi(4),4)>=3 & fltrdo_algoritmo(filtroi(4),4)<=5),',... %Inhabilitación/Deshabilitación del rizo:
      '	   else,',...%Deshabilitamos el rizo:
      '		   set(editHndl.fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '		   set(text_fltrdo_rizo_c_ch4,''enable'',''off'');',...
      '	   end;',... 
      '  end;',...
      '	[Nums.ch4,Dens.ch4]  = NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      'end;',...
      'if (Num==1 & Den==1),',...%Sobretodo pensado por si hay un error al cargar un filtro
      '   fltrdo_algoritmo_ch4(filtroi(4),4)=1;',...
      '   set(popup_fltrdo_algoritmo_ch4,''Value'',1);',...
      'end;'];

popup_fltrdo_algoritmo_ch4 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+2.5 y4+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar', ...
   'ToolTipString','Elija el algoritmo de fltrdo',...
   'Value',fltrdo_algoritmo(filtroi(4),4), ...
   'CallBack',Accionpopup_fltrdo_algoritmo_ch4); 

%------------------------Menú pop-up para elegir filtro Paso-alto/Paso-bajo/Rechazo-Banda:
Accionpopup_fltrdo_tipo_ch4=['fltrdo_tipo(filtroi(4),4) = get(popup_fltrdo_tipo_ch4,''Value'');',...
      'if fltrdo_tipo(filtroi(4),4)<=2,',...%es pasobajo/pasoalto
      'set(editHndl.fltrdo_fc2_ch4,''enable'',''off'');',...
      'else,',...%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
      'set(editHndl.fltrdo_fc2_ch4,''enable'',''on'');',...
      'end;',...
      '[Nums.ch4,Dens.ch4] = NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
      ];

popup_fltrdo_tipo_ch4 = uicontrol( ...
   'Style','popup', ...
   'Units','cent', ...
   'Position',[x1+4.8 y4+1.8 2.7 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String','Pasobajo|Pasoalto|PasoBanda|Rechazobanda', ...
   'ToolTipString','Elija el tipo de filtro',...
   'Value',fltrdo_tipo(filtroi(4),4), ...
   'CallBack',Accionpopup_fltrdo_tipo_ch4); 

%-----------------------------------------FILTROS SEGUN ORDEN/RIZADO/FRECUENCIAS DE CORTE:
%----------------------------------------------------------------------- Orden del filtro:
text_fltrdo_orden_ch4=uicontrol( ...
   'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y4+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Orden:', ...
   'ToolTipString','Orden del filtro');

Accion_fltrdo_orden_ch4=['fltrdo_orden(filtroi(4),4)=str2num(get(editHndl.fltrdo_orden_ch4,''String''));',...
      '[Nums.ch4,Dens.ch4] = NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
   ];
editHndl.fltrdo_orden_ch4 = uicontrol( ...  
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+1.15 y4+1.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_orden(filtroi(4),4)], ... 
   'ToolTipString','',...
   'CallBack',Accion_fltrdo_orden_ch4); 

%-------------------------------------------- Rizado en la banda de paso limitado por fc:
text_fltrdo_rizo_c_ch4=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+2 y4+1.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizado[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)');

Accion_fltrdo_rizo_c_ch4=['fltrdo_rizo_c(filtroi(4),4)=str2num(get(editHndl.fltrdo_rizo_c,''String''));',...
      '[Nums.ch4,Dens.ch4] = NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_rizo_c_ch4 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+3.6 y4+1.2 .8 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_c(filtroi(4),4)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso/rechazo(sólo para Elípticos y Chebyshev)',...
    'CallBack',Accion_fltrdo_rizo_c_ch4); 
 
if (fltrdo_algoritmo(filtroi(4),4)>=3 & fltrdo_algoritmo(filtroi(4),4)<=4),
   set(editHndl.fltrdo_rizo_c_ch4,'enable','on');
   set(text_fltrdo_rizo_c_ch4,'enable','on');
else,
   set(editHndl.fltrdo_rizo_c_ch4,'enable','off');
   set(text_fltrdo_rizo_c_ch4,'enable','off')
end;

%--------------------------------------------------------Frecuencias de corte del filtro:
%Pueden especificarse una o dos frecuencias, dependiendo de si hablamos de un fltrdo
%pasoalto/pasobajo o pasobanda/rechazobanda.
%Para los filtros sin rizo, esta frecuencia es la frec. de 3dB de atenuacion, y para los
%filtros con rizo es la frecuencia de 'rizo' dB de atenuacion.
text_fltrdo_fc1_ch4=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+4.5 y4+1.2 3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','frecs. de corte[Hz]:fc1:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');

Accion_fltrdo_fc1_ch4=['fltrdo_fc1(filtroi(4),4)=str2num(get(editHndl.fltrdo_fc1_ch4,''String''));',...
      'if fltrdo_fc1(filtroi(4),4)>Fs/2, fltrdo_fc1(filtroi(4),4)=Fs/2; set(editHndl.fltrdo_fc1_ch4,''String'',[fltrdo_fc1(filtroi(4),4)]);',...
      'aviso(''Frecuencia de corte tiene que se menor que la de Nyquist''); end;',...
      '[Nums.ch4,Dens.ch4] = NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_fc1_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+7.4 y4+1.2 .9 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc1(filtroi(4),4)], ... 
   'ToolTipString','Frecuencia de corte inferior del filtro(sin normalizar)',...
   'CallBack',Accion_fltrdo_fc1_ch4); 

text_fltrdo_fc2_ch4= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+8.3 y4+1.2 .5 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','fc2:', ...
   'ToolTipString','Frecuencias de corte del filtro(sin normalizar)');
Accion_fltrdo_fc2_ch4= ['fltrdo_fc2(filtroi(4),4)=str2num(get(editHndl.fltrdo_fc2_ch4,''String''));',...
      'if fltrdo_fc2(filtroi(4),4)<=fltrdo_fc1(filtroi(4),4), fltrdo_fc1(filtroi(4),4)=1.1*fltrdo_fc2(filtroi(4),4); set(editHndl.fltrdo_fc2_ch4,''String'',[fltrdo_fc2(filtroi(4),4)]);',...
      'aviso(''Frecuencia de corte superior tiene que ser mayor que la inferior''); end;',...
      '[Nums.ch4,Dens.ch4] = NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_fc2_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y4+1.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_fc2(filtroi(4),4)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior del filtro sin normalizar',...
   'CallBack',Accion_fltrdo_fc2_ch4);

if fltrdo_tipo(filtroi(4),4)<=2,%es pasobajo/pasoalto
   set(editHndl.fltrdo_fc2_ch4,'enable','off');
else,%Se necesita una 2ª frecuencia(f2) para determinar el BW de paso/rechazo
   set(editHndl.fltrdo_fc2_ch4,'enable','on');
end;

%---------------------------------------------------FILTROS SEGUN BANDAS DE PASO/RIZADOS:
%---------------------------------------------------------------Banda de Paso del filtro:
%Es la banda de paso del filtro, en la que habra un rizo maximo indicado por Rp(rizo
%en la banda de paso).
text_fltrdo_paso1_ch4=uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y4+.7 2.9 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de paso[Hz]=[', ...
   'ToolTipString','Banda de paso[fp1,fp2][Hz] del filtro');

Accion_fltrdo_wp1_ch4=['fltrdo_wp1(filtroi(4),4)=str2num(get(editHndl.fltrdo_wp1_ch4,''String''));',...
      'if (fltrdo_wp1(filtroi(4),4)>=fltrdo_wp2(filtroi(4),4) | fltrdo_wp1(filtroi(4),4)<=fltrdo_ws1(filtroi(4),4)),',...
      'fltrdo_wp1(filtroi(4),4)=min(1.1*fltrdo_ws1(filtroi(4),4),0.9*fltrdo_wp2(filtroi(4),4));',...
      'set(editHndl.fltrdo_wp1_ch4,''String'',[fltrdo_wp1(filtroi(4),4)]);',...
      'aviso(''f_paso1 debe quedar en (f_rechazo1,f_paso2).'');',...
      'end;',...
      '[Nums.ch4,Dens.ch4]= NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
   ];
editHndl.fltrdo_wp1_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.15 y4+.7 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp1(filtroi(4),4)], ... 
   'ToolTipString','Frecuencia de paso inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp1_ch4); 

text_fltrdo_paso2_ch4= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+3.95 y4+.7 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_wp2_ch4= ['fltrdo_wp2(filtroi(4),4)=str2num(get(editHndl.fltrdo_wp2_ch4,''String''));',...
      'if (fltrdo_wp2(filtroi(4),4)>=fltrdo_ws2(filtroi(4),4) | fltrdo_wp2(filtroi(4),4)<=fltrdo_wp1(filtroi(4),4)),',...
      'fltrdo_wp2(filtroi(4),4)=max(1.1*fltrdo_wp1(filtroi(4),4),0.9*fltrdo_ws2(filtroi(4),4));',...
      'set(editHndl.fltrdo_wp2_ch4,''String'',[fltrdo_wp2(filtroi(4),4)]);',...
      'aviso(''f_paso2 debe quedar en (f_paso1,f_rechazo2).'');',...
      'end;',...
      '[Nums.ch4,Dens.ch4]= NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_wp2_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.1 y4+.7 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_wp2(filtroi(4),4)], ... 
   'ToolTipString','Frecuencia[Hz] de paso superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_wp2_ch4);

text_fltrdo_paso3_ch4= uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.1 y4+.7 1.9 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] --------------->');

%------------------------------------- Rizado en la banda de paso limitado por [wp1,wp2]:
text_fltrdo_rizo_p_ch4= uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y4+.7 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de paso');

Accion_fltrdo_rizo_p_ch4= ['fltrdo_rizo_p(filtroi(4),4)=str2num(get(editHndl.fltrdo_rizo_p_ch4,''String''));',...
      '[Nums.ch4,Dens.ch4]= NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_rizo_p_ch4 = uicontrol( ...
    'Style','edit', ...
    'Units','cent', ...
    'Position',[x1+8.8 y4+.7 1 alt], ...
    'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
    'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',[fltrdo_rizo_p(filtroi(4),4)], ... 
    'ToolTipString','rizo[dB] del filtro en la banda de paso',...
    'CallBack',Accion_fltrdo_rizo_p_ch4); 
 
%------------------------------------------------Banda de Rechazo del filtro[ws1,ws2]:
%Es la banda de rechazo del filtro, en la que habra un rizo maximo indicado por 
%fltrdo_rizo_s(rizo en la banda de rechazo).
text_fltrdo_rechazo1_ch4= uicontrol( 'Style','text', ...
   'Units','cent', ...
   'Position',[x1+.25 y4+.2 3.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ...
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'HorizontalAlignment','left',...
   'String','Banda de rechazo[Hz]=[', ...
   'ToolTipString','Banda de rechazo[fs1,fs2][Hz] del filtro');

Accion_fltrdo_ws1_ch4= ['fltrdo_ws1(filtroi(4),4)=str2num(get(editHndl.fltrdo_ws1_ch4,''String''));',...
      'if (fltrdo_ws1(filtroi(4),4)>=fltrdo_wp1(filtroi(4),4) | fltrdo_ws1(filtroi(4),4)<=0),',...
      'fltrdo_ws1(filtroi(4),4)=max(.1,0.9*fltrdo_wp1(filtroi(4),4));',...
      'set(editHndl.fltrdo_ws1_ch4,''String'',[fltrdo_ws1(filtroi(4),4)]);',...
      'aviso(''f_rechazo1 debe quedar en (0,f_paso1).'');',...
      'end;',...
      '[Nums.ch4,Dens.ch4]= NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_ws1_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+3.45 y4+.2 .8 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws1(filtroi(4),4)], ... 
   'ToolTipString','Frecuencia de corte inferior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws1_ch4); 

text_fltrdo_rechazo2_ch4=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+4.25 y4+.2 .2 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String',',');
Accion_fltrdo_ws2_ch4=['fltrdo_ws2(filtroi(4),4)=str2num(get(editHndl.fltrdo_ws2_ch4,''String''));',...
      'if (fltrdo_ws2(filtroi(4),4)>=Fs/2 | fltrdo_ws2(filtroi(4),4)<=fltrdo_wp2(filtroi(4),4)),',...
      'fltrdo_ws2(filtroi(4),4)=min(1.1*fltrdo_wp2(filtroi(4),4),0.9*Fs/2);',...
      'set(editHndl.fltrdo_ws2_ch4,''String'',[fltrdo_ws2(filtroi(4),4)]);',...
      'aviso(''f_rechazo2 debe quedar en (f_paso2,Fs/2).'');',...
      'end;',...
      '[Nums.ch4,Dens.ch4]=NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_ws2_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+4.4 y4+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_ws2(filtroi(4),4)], ... 
   'ToolTipString','Frecuencia[Hz] de corte superior(sin normalizar) del filtro',...
   'CallBack',Accion_fltrdo_ws2_ch4);

text_fltrdo_rechazo3_ch4=uicontrol( ...
    'Style','text','Units','cent','Position',[x1+5.4 y4+.2 1.6 alt], ...
    'BackgroundColor',COLOR_FONDO_TEXTOS,'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
    'String','] ------------>');

%------------------------------------- Rizado en la banda de rechazo limitado por [ws1,ws2]:
text_fltrdo_rizo_s_ch4=uicontrol( ...
		'Style','text', ...
        'Units','cent', ...
        'Position',[x1+7 y4+.2 1.6 alt], ...
        'BackgroundColor',COLOR_FONDO_TEXTOS, ...
        'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
        'HorizontalAlignment','left',...
        'String','Rizado[dB]:', ...
        'ToolTipString','rizo[dB] del filtro en la banda de rechazo');

Accion_fltrdo_rizo_s_ch4=['fltrdo_rizo_s(filtroi(4),4)=str2num(get(editHndl.fltrdo_rizo_s_ch4,''String''));',...
      '[Nums.ch4,Dens.ch4]= NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      ];
editHndl.fltrdo_rizo_s_ch4 = uicontrol( ...
   'Style','edit', ...
   'Units','cent', ...
   'Position',[x1+8.8 y4+.2 1 alt], ...
   'BackgroundColor',COLOR_FONDO_PETICIONES, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'String',[fltrdo_rizo_s(filtroi(4),4)], ...
   'ToolTipString','rizo[dB] del filtro en la banda de rechazo',...
   'CallBack',Accion_fltrdo_rizo_s_ch4);

%---------------------------------------------------------PLOT FILTRO(en Panel de Control)
%Para hacerlo, hay que esperar a tener todas las variables que pide.
Accion_eje_salida=[...
         'figure(4);',...
         'freqz(Nums.ch4(filtroi(4),:),Dens.ch4(filtroi(4),:),512,Fs);',...
         'title([''Filtro '' num2str(filtroi(4)) ]);',...
         'pulsador;',...
         'Numtotal=1;   Dentotal=1;',...%Esta funcion se llamara una vez terminado NumDenFiltro2,
         'for nf=1:nmfltros,',...%asi que habra que usar variables que existan en ese momento
         '  Numtotal=conv(Numtotal,Nums.ch4(nf,:));',...
         '  Dentotal=conv(Dentotal,Dens.ch4(nf,:));',...
         'end;',...
         'freqz(Numtotal,Dentotal,512,Fs);',...
         'title(''Filtro conjunto'');'];
eje_filtro_ch4= axes('Units','cent','Position',[.4 y4+.4 2 2],'ButtonDownFcn',Accion_eje_salida);
PlotFiltro(filtroi(4),Nums.ch4,Dens.ch4,eje_filtro_ch4); %Es una funcion.
%-------------------------------------------------------------------Boton MODO de filtrado:
%Sirve para conmutar entre la Forma 1 y la Forma 2 de calcular un filtro.
Accion_push_modof_ch4= [...
      'if modof(filtroi(4),4)==1,  modof(filtroi(4),4)=2;',...%Forma2=> Parametros(Wp=[wp1,wp2], Ws=[ws1,ws2], Rp, Rs)
      '  set(popup_fltrdo_algoritmo_ch4,''String'',''Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');',...
      '  if fltrdo_algoritmo(filtroi(4),4)==3,',...%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      '     fltrdo_algoritmo(filtroi(4),4)= 1;	set(popup_fltrdo_algoritmo_ch4,''Value'',1);',...
      '  elseif fltrdo_algoritmo(filtroi(4),4)>3,',...%Hay  que restar 1 pq en modof(filtroi(4),4)==2, no hay Bessel
      '     fltrdo_algoritmo(filtroi(4),4)= fltrdo_algoritmo(filtroi(4),4) - 1;	set(popup_fltrdo_algoritmo_ch4,''Value'',fltrdo_algoritmo(filtroi(4),4));',...
      '  end;',...
      '  set(pushHndl_modof_ch4,''String'',''Modo 2'');',...%Quitamos el algoritmo de Bessel, q no puede hacerse asi:
      '  set(popup_fltrdo_tipo_ch4,''Enable'',''off'');',... %pasobajo, pasoalto, pasobanda,...
      '  set(editHndl.fltrdo_orden_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_c_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc1_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_fc2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_paso1_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_paso2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_paso3_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp1_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_wp2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_p_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_p_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo1_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rechazo3_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws1_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_ws2_ch4,''Enable'',''on'');',...
      '  set(text_fltrdo_rizo_s_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_rizo_s_ch4,''Enable'',''on'');',...
      '	[Nums.ch4,Dens.ch4] = NumDenFiltro2(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),[fltrdo_wp1(:,4) fltrdo_wp2(:,4)]/(Fs/2),[fltrdo_ws1(:,4) fltrdo_ws2(:,4)]/(Fs/2),fltrdo_rizo_p(:,4),fltrdo_rizo_s(:,4),Nums.ch4,Dens.ch4);',...
      'else,         modof(filtroi(4),4)=1;',...%Forma 1=> Parametros(orden,rizo,Wn)
      '  set(pushHndl_modof_ch4,''String'',''Modo 1'');',...
      '  set(popup_fltrdo_algoritmo_ch4,''String'',''Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar'');'...
      '  if fltrdo_algoritmo(filtroi(4),4)>2,',...%(3=>Chebyshev 1)Hay  que sumar 1 ya que en modof==1 si hay Bessel
      '     fltrdo_algoritmo(filtroi(4),4)= fltrdo_algoritmo(filtroi(4),4) + 1;	set(popup_fltrdo_algoritmo_ch4,''Value'',fltrdo_algoritmo(filtroi(4),4));',...
      '  end;',...
      '  set(popup_fltrdo_tipo_ch4,''Enable'',''on'',''Value'', fltrdo_tipo(filtroi(4),4));',...
      '  set(editHndl.fltrdo_orden_ch4,''Enable'',''on'');',...
      '  if (fltrdo_algoritmo(filtroi(4),4)>=4 & fltrdo_algoritmo(filtroi(4),4)<=6),',...
      '     set(editHndl.fltrdo_rizo_c_ch4,''enable'',''on'');',...
      '     set(text_fltrdo_rizo_c_ch4,''enable'',''on'');',...
      '  else,',...%Nada porque ya estan off
      '  end;',...
      '  set(editHndl.fltrdo_fc1_ch4,''Enable'',''on'');',...
      '  set(editHndl.fltrdo_fc2_ch4,''Enable'',''on'');',...%Al ser siempre pasobanda, siempre se activa fc2 
      '  set(text_fltrdo_paso1_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_paso2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_paso3_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp1_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_wp2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_p_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_p_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo1_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rechazo3_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws1_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_ws2_ch4,''Enable'',''off'');',...
      '  set(text_fltrdo_rizo_s_ch4,''Enable'',''off'');',...
      '  set(editHndl.fltrdo_rizo_s_ch4,''Enable'',''off'');',...
      '  [Nums.ch4,Dens.ch4] = NumDenFiltro1(eje_filtro_ch4,filtroi(4),fltrdo_algoritmo(:,4),fltrdo_orden(:,4),fltrdo_rizo_c(:,4),fltrdo_tipo(:,4),[fltrdo_fc1(:,4) fltrdo_fc2(:,4)]/(Fs/2),Nums.ch4,Dens.ch4);',...
      'end;'];
pushHndl_modof_ch4= uicontrol( ...
   'Style','pushbutton', ...
   'Units','cent', ...
   'Position',[x1+7.5 y4+1.8 2.3 alt], ...
   'BackgroundColor',COLOR_FONDO_TEXTOS, ... %Color del fondo
   'ForegroundColor',COLOR_TEXTO_PETICIONES, ...
   'ToolTipString','Modo 1/2 de fltrdo',...
   'String',['Modo ' num2str(modof(filtroi(4),4))], ...
   'CallBack',Accion_push_modof_ch4);

%Al iniciar el programa, hay que adaptar el panel al valor de 'modof':
%NOTA: Al comienzo, todo esta 'on' solo hay que concentrarse en poner 'off':
if modof(filtroi(4),4)==1,
   set(popup_fltrdo_algoritmo_ch4,'String','Ninguno|Butterworth|Bessel|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   %set(popup_fltrdo_tipo,'Enable','on');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(text_fltrdo_paso1_ch4,'Enable','off');
   set(text_fltrdo_paso2_ch4,'Enable','off');
   set(text_fltrdo_paso3_ch4,'Enable','off');
   set(editHndl.fltrdo_wp1_ch4,'Enable','off');
   set(editHndl.fltrdo_wp2_ch4,'Enable','off');
   set(text_fltrdo_rizo_p_ch4,'Enable','off');
   set(editHndl.fltrdo_rizo_p_ch4,'Enable','off');
   set(text_fltrdo_rechazo1_ch4,'Enable','off');
   set(text_fltrdo_rechazo2_ch4,'Enable','off');
   set(text_fltrdo_rechazo3_ch4,'Enable','off');
   set(editHndl.fltrdo_ws1_ch4,'Enable','off');
   set(editHndl.fltrdo_ws2_ch4,'Enable','off');
   set(text_fltrdo_rizo_s_ch4,'Enable','off');
   set(editHndl.fltrdo_rizo_s_ch4,'Enable','off');
else,  %El modo 2 de parámetros no acepta Bessel, ni necesita el tipo de fltrdo(pasobajo, pasoalto, ...)
   if fltrdo_algoritmo(filtroi(4),4)==3,%Osea Bessel, que ya hemos dicho que no se acepta en Matlab:
      fltrdo_algoritmo(filtroi(4),4)=1;
      set(popup_fltrdo_algoritmo_ch4,'Value',1);
   end;
   set(popup_fltrdo_algoritmo_ch4,'String','Ninguno|Butterworth|Chebyshev I|Chebyshev II|Elíptico|Cargar|Diseñar');
   set(popup_fltrdo_tipo_ch4,'Enable','off');%tipo es: pasobajo, pasoalto, pasobanda, rechazobanda.
   set(editHndl.fltrdo_orden_ch4,'Enable','off');
   set(editHndl.fltrdo_rizo_c_ch4,'Enable','off');
   set(editHndl.fltrdo_fc1_ch4,'Enable','off');
   set(editHndl.fltrdo_fc2_ch4,'Enable','off');
end;

% ------------------------------------------------------------------------ BARRA DE MENU
labels = str2mat( ...
   '&Filtros',...
   '>Grabar filtro equivalente del Canal 1 ^1',...
   '>Grabar filtro equivalente del Canal 2 ^2',...
   '>Grabar filtro equivalente del Canal 3 ^3',...
   '>Grabar filtro equivalente del Canal 4 ^4',...
   '&Ayuda' ...
   );

call_GrabarFiltro1=[...
      'Numcopia=Num; Dencopia=Den;',...%Guardamos una copia de los Num y Den que tuvieramos(reservados para fdatool)
      'Num=1;   Den=1;',...%Hallamos el filtro conjunto:
      'for nf=1:nmfltros,',...
      '  Num=conv(Num,Nums.ch1(nf,:));',...
      '  Den=conv(Den,Dens.ch1(nf,:));',...
      'end;',... %Eliminamos los 0's de la izquierda, que no sirven:
      'while Num(1)==0,	Num=Num(2:end);	end;',...
      'while Den(1)==0,	Den=Den(2:end);	end;',...
      '[nomfich, pathfich] = uiputfile(''.mat'', ''Nombre del filtro'');',...
      'cmd =[''save '' pathfich nomfich '' Num Den''];',...%Componemos el comando 'grabar'
      'eval(cmd);',...%Ejecutamos el comando grabar;
      'Num=Numcopia; Den=Dencopia;',... %Reponemos los Num y Den originales(reservados para fdatool)
   ]; %Es mejor dejar el SAVE aquí pq asi tengo mas control
call_GrabarFiltro2=[...
      'Numcopia=Num; Dencopia=Den;',...%Guardamos una copia de los Num y Den que tuvieramos(reservados para fdatool)
      'Num=1;   Den=1;',...%Hallamos el filtro conjunto:
      'for nf=1:nmfltros,',...
      '  Num=conv(Num,Nums.ch2(nf,:));',...
      '  Den=conv(Den,Dens.ch2(nf,:));',...
      'end;',... %Eliminamos los 0's de la izquierda, que no sirven:
      'while Num(1)==0,	Num=Num(2:end);	end;',...
      'while Den(1)==0,	Den=Den(2:end);	end;',...
      '[nomfich, pathfich] = uiputfile(''.mat'', ''Nombre del filtro'');',...
      'cmd =[''save '' pathfich nomfich '' Num Den''];',...%Componemos el comando 'grabar'
      'eval(cmd);',...%Ejecutamos el comando grabar;
      'Num=Numcopia; Den=Dencopia;',... %Reponemos los Num y Den originales(reservados para fdatool)
   ]; %Es mejor dejar el SAVE aquí pq asi tengo mas control
call_GrabarFiltro3=[...
      'Numcopia=Num; Dencopia=Den;',...%Guardamos una copia de los Num y Den que tuvieramos(reservados para fdatool)
      'Num=1;   Den=1;',...%Hallamos el filtro conjunto:
      'for nf=1:nmfltros,',...
      '  Num=conv(Num,Nums.ch3(nf,:));',...
      '  Den=conv(Den,Dens.ch3(nf,:));',...
      'end;',... %Eliminamos los 0's de la izquierda, que no sirven:
      'while Num(1)==0,	Num=Num(2:end);	end;',...
      'while Den(1)==0,	Den=Den(2:end);	end;',...
      '[nomfich, pathfich] = uiputfile(''.mat'', ''Nombre del filtro'');',...
      'cmd =[''save '' pathfich nomfich '' Num Den''];',...%Componemos el comando 'grabar'
      'eval(cmd);',...%Ejecutamos el comando grabar;
      'Num=Numcopia; Den=Dencopia;',... %Reponemos los Num y Den originales(reservados para fdatool)
   ]; %Es mejor dejar el SAVE aquí pq asi tengo mas control
call_GrabarFiltro4=[...
      'Numcopia=Num; Dencopia=Den;',...%Guardamos una copia de los Num y Den que tuvieramos(reservados para fdatool)
      'Num=1;   Den=1;',...%Hallamos el filtro conjunto:
      'for nf=1:nmfltros,',...
      '  Num=conv(Num,Nums.ch4(nf,:));',...
      '  Den=conv(Den,Dens.ch4(nf,:));',...
      'end;',... %Eliminamos los 0's de la izquierda, que no sirven:
      'while Num(1)==0,	Num=Num(2:end);	end;',...
      'while Den(1)==0,	Den=Den(2:end);	end;',...
      '[nomfich, pathfich] = uiputfile(''.mat'', ''Nombre del filtro'');',...
      'cmd =[''save '' pathfich nomfich '' Num Den''];',...%Componemos el comando 'grabar'
      'eval(cmd);',...%Ejecutamos el comando grabar;
      'Num=Numcopia; Den=Dencopia;',... %Reponemos los Num y Den originales(reservados para fdatool)
   ]; %Es mejor dejar el SAVE aquí pq asi tengo mas control
calls = str2mat( ...
   '',...
   call_GrabarFiltro1,...
   call_GrabarFiltro2,...
   call_GrabarFiltro3,...
   call_GrabarFiltro4,...
   'aviso(''Ayuda no disponible'');' ...
   );

handles = makemenu(gcf, labels, calls);
